import{$ as et,Aa as Or,B as ge,Ba as rt,C as Me,Da as Tr,Fa as Sn,H as wr,Ia as St,J as br,N as xe,Na as Rr,O as ue,Oa as Hr,P as Oe,Ua as _t,W as Ct,X as vr,Y as Ar,Z as Er,_ as pe,a as J,aa as Ge,b as Y,c as Je,d as Cn,e as vt,f as W,g as hr,ga as De,h as fr,ha as Cr,ia as Le,k as gr,l as mr,n as At,o as Et,p as Ze,pa as Sr,q as yr,ra as _r,sa as tt,ta as Pr,ya as kr}from"./chunk-DRPAV72M.js";var kt=Cn((nt,Pt)=>{"use strict";(function(ee,X){typeof nt=="object"&&typeof Pt=="object"?Pt.exports=X():typeof define=="function"&&define.amd?define([],X):typeof nt=="object"?nt.reporting=X():ee.reporting=X()})(self,function(){return function(){var ee={632:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(328),x=u(168),l=u(552),a=u(916);class v extends P.Form{constructor(i,w,m={}){super(i,w,m)}setForm(i){let w;if(typeof(i=i||this.form)=="string"){let m=new P.Formio(i),d;w=(0,a.checkLicense)().then(()=>this.getSubmission(m,this.options)).catch(C=>{d=C}).then(C=>{let A=null;if(d&&(A=this.errorForm(d)),this.instance=this.instance||(A?super.create():this.create()),this.instance.url=i,this.instance.nosubmit=!0,this._form=this.instance.form=A||{components:[],report:C},d)throw d;return this.instance})}else if(l._.isPlainObject(i)&&this.options.projectEndpoint){let m;w=(0,a.checkLicense)().then(()=>(this.instance=this.instance||this.create(),this.instance.url=this.options.projectEndpoint,this._form=this.instance.form={components:[],report:i},this.instance.ready)).catch(d=>{m=d}).then(()=>{if(m){let d=this.errorForm(m);throw this.instance=super.create(),this.instance.nosubmit=!0,this._form=this.instance.form=d,m}})}else{this.instance=this.instance||super.create();let m=i?l._.isPlainObject(i)&&!this.options.projectEndpoint?"Unable to create a report. The projectEndpoint option is required for reports rendered using the JSON schema.":"Unable to create a report. Please make sure you are using correct parameters.":"Unable to create a report. No report URL or JSON schema is provided.";this._form=this.instance.form=this.errorForm(this.t(m)),w=this.instance.ready}return w.then(()=>(this.element=this.instance.element,this.instance))}create(){return new x.default(this.element,this.options)}static create(i,w,m={}){return new v(i,w,m).ready}}Object.freeze(v.prototype),o.default=Object.freeze(v)},168:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(328),x=u(288),l=P.Displays.getDisplay("webform");o.default=class extends l{init(){var a;try{let v=this.form.report;if(!v)return super.init();let s={label:"Reporting Grid",key:x.default.reportingGridConfig.gridKey,type:"reportinggrid",input:!0,hideLabel:!0,components:[]},i={label:"Reporting Controls",key:x.default.reportingControlsConfig.controlsKey,type:"reportingcontrols",hideLabel:!0,input:!0,components:[]};return this.form.components=v.data.enableControls?[i,s]:[s],this.reportingLoading=!0,this.reportingFormsReady=this.formio.loadForms({params:{_id__in:P.Utils._.join(((a=v.data)===null||a===void 0?void 0:a.forms)||[],",")}}).then(w=>{if(v.data.forms&&w&&w.length<v.data.forms.length)return void this.setAlert("danger",this.t("Unable to get all Report Source Forms."));this.reportingForms=w,this.reportingLoading=!1;let m=super.init();return this.redraw(),m}).catch(w=>{this.setAlert("danger",this.t("Unable to get the Report Source Forms.")+": "+w),this.reportingLoading=!1}),this.reportingFormsReady}catch(v){this.setAlert("danger",this.t("Report Form initialization error")+": "+v)}}render(){return this.reportingLoading?super.render(this.renderTemplate("loader")):super.render()}}},92:function(U,o,u){"use strict";var P=this&&this.__awaiter||function(i,w,m,d){return new(m||(m=Promise))(function(C,A){function p(T){try{E(d.next(T))}catch(g){A(g)}}function y(T){try{E(d.throw(T))}catch(g){A(g)}}function E(T){var g;T.done?C(T.value):(g=T.value,g instanceof m?g:new m(function(b){b(g)})).then(p,y)}E((d=d.apply(i,w||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});let x=u(328),l=x.Components.components.nested,a=u(552),v=u(944),s=u(288);o.default=class extends l{static schema(...i){return l.schema({label:"Reporting Controls",key:"reportingControls",type:"reportingcontrols",tag:"div",hideLabel:!0},...i)}static get builderInfo(){return{}}constructor(i,w,m){super(i,w,m)}get controlsEvents(){return s.default.reportingControlsConfig.events}get singleFilterOperators(){return s.default.getSingleFilterOperators()}get reportingConfig(){return this.root.form.report.data}get reportingForms(){return this.root.reportingForms}get reportingId(){return this.root.form.report._id}get formioGrid(){return this.reportingGrid.formioGrid}get controlsSaveKey(){return""+s.default.reportingControlsConfig.controlsKey+this.reportingId}attach(i){let w=s.default.reportingGridConfig,m=s.default.reportingControlsConfig;this.reportingGrid=this.root.getComponent(w.gridKey);let{filters:d,columns:C}=this.storageService.getAllData()||{},A=a._.get(d,"controls",null);if(A){let p=this.getComponent(m.filtersCompKey);a._.isEqual(A,p.dataValue)||(p.setValue(A),a._.each(this.filterSettings,y=>{let E=a._.get(A,y.key,!1);y.set=a._.isObject(E)&&!a._.isEmpty(E)||!a._.isObject(E)&&E||a._.isNumber(E)}))}if(C){let p=this.getComponent(m.displayedColumnsCompKey);a._.isEqual(C,p.dataValue)||p.setValue(C)}return super.attach(i)}getFilterComponents(){let{filters:i,calculatedColumns:w=[],groups:m={}}=this.reportingConfig;return a._.chain(i).map(({field:d,filterType:C,filterTitle:A},p)=>{let{path:y,formId:E,default:T}=d,g={};if(E){let _=null;if(T)_=a._.get(a._.find(s.default.defaultColumns,H=>H.path===y),"component",null);else{let H=a._.find(this.reportingForms,I=>I._id===E);_=H?x.Utils.getComponent(H.components,y,!1):null}if(!_)return null;g=s.default.convertReportingFormCompIntoGridComp(_,Object.assign(Object.assign({},d),{displayTitle:A}))}else{let _=[...w,...m.calculatedColumns||[]],H=a._.find(_,I=>I.key===y);if(!H)return null;g=s.default.convertReportingCalcSettingsIntoGridComp(Object.assign(Object.assign({},H),{name:A||H.name}),this.reportingConfig)}let b=this.getFilterValueCompFromGridComp(g,C,p);return this.filterSettings.push({key:b.key,operator:C,pathInGrid:g.key,initialType:g.type,set:!1}),b}).filter(d=>d).value()}getFilterValueCompFromGridComp(i,w,m){var d;let C={};if(a._.includes(this.singleFilterOperators,w))C=s.default.getSingleFilterOperatorValueComp(w);else{let p=((d=x.Formio.Components.components[i.type||"base"])===null||d===void 0?void 0:d.conditionOperatorsSettings)||{},{valueComponent:y=()=>({type:"textfield"})}=p;C=y(i)}let A="filterComp"+m;return Object.assign(Object.assign(Object.assign({},i),C),{key:A,labelPosition:this.reportingConfig.filterLabelPosition||"top",logic:[s.default.getFilterSetStyleLogic()]})}toggleFilterClass(i){if(!i.element)return;let w=a._.find(this.filterSettings,p=>p.key===i.component.key),m=a._.get(w,"set",!1),d=i.element.classList,C=s.default.reportingControlsConfig.filterSetClass,A=d.contains(C);m&&!A&&d.add(C),!m&&A&&d.remove(C)}getTabs(){let i=this.reportingConfig||{},{filters:w=[],actions:m=[]}=i,d=[];return w.length&&(this.filterSettings=[],d.push(s.default.getFiltersTab(this.getFilterComponents(),i.filtersPerRow||1))),d.push(s.default.getColumnsTab()),m.length&&d.push(s.default.getActionsTab(m)),d}formatFilterValue(i,w){let{operator:m,initialType:d}=i;if(a._.includes(this.singleFilterOperators,m)){let C=x.Components.components[d],A=C?new C:null;return A?A.emptyValue:w}return d==="datetime"?"Date("+w+")":w}getActionComponents(i){let w=this.formioGrid.component.components||[];return i==="visibleColumns"?a._.filter(w,m=>m.show):w}setGridFilters(i={}){this.formioGrid&&(this.formioGrid.options.fetchProvider.defaultFilters=i,this.formioGrid.redraw())}getGridFilters(){return a._.get(this,"formioGrid.options.fetchProvider.defaultFilters",{})}downloadPDF(i){return P(this,void 0,void 0,function*(){var w,m,d;let{applyFor:C}=i,A=a._.map(this.reportingGrid.selectedRows||[],y=>({data:y})),p=yield s.default.getPDFDownloadUrl({projectId:((m=(w=this.root.form)===null||w===void 0?void 0:w.report)===null||m===void 0?void 0:m.project)||((d=this.reportingForms[0])===null||d===void 0?void 0:d.project),submissions:A,form:{title:this.reportingConfig.title,components:this.getActionComponents(C)}});window.open(p,"_blank")})}exportCSV(i){let{applyFor:w}=i;s.default.convertToCSV({submissions:this.reportingGrid.selectedRows||[],components:this.getActionComponents(w),fileName:a._.camelCase(this.reportingConfig.title)})}onApplyColumns(){let i=this.data.displayedColumns||[],w=this.formioGrid.component.components||[];a._.each(w,m=>{m.show=a._.includes(i,m.key)}),this.formioGrid.noFetchInAttach=!0,this.formioGrid.redraw(),this.storageService.saveData({columns:i})}performCustomAction(i){let{customCode:w=""}=i,m=this.evaluate(w,{reportingForms:this.reportingForms,reporting:this.root.form.reporting,selectedRows:this.reportingGrid.selectedRows,reportingControls:this,reportingGrid:this.reportingGrid},"promise");return m&&m.then?m.then(d=>{d&&(this.reportingGrid.selectedRows=[],this.formioGrid.removeSelections(),this.formioGrid.redraw())}):m}executeAction(i){let w=this,m=this.getComponent(s.default.reportingControlsConfig.events.performAction);this.performingAction=!0,m.checkData(),Promise.resolve().then(()=>{switch(i.type){case"pdf":return w.downloadPDF(i);case"csv":return w.exportCSV(i);case"custom":return w.performCustomAction(i)}}).then(()=>{w.performingAction=!1,m.checkData()}).catch(d=>{console.error(this.t("Error while performing the Report Action")+": "+d),w.performingAction=!1,m.checkData();let C=this.getComponent(s.default.reportingControlsConfig.actionCompKey);C.pristine=!1,C.setComponentValidity([{level:"error",message:this.t("Error while performing the Report Action")+": "+d}])})}onApplyFilters(){let i={},w=this.data.filters;a._.each(this.filterSettings,m=>{m.set=!1;let{key:d,operator:C,pathInGrid:A}=m,p=a._.get(w,d,null),y=!a._.includes(this.singleFilterOperators,C);if(!y&&p||y&&(!a._.isEmpty(p)||a._.isNumber(p))){let E=s.default.FilterOperators[C].filterKey,T={value:A,comparedValue:this.formatFilterValue(m,p)};m.set=!0,i[E]?i[E].push(T):i[E]=[T]}}),this.preview||this.storageService.saveData({filters:{grid:i,controls:w}}),this.formioGrid&&this.formioGrid.topPagination&&(this.formioGrid.topPagination.component.currentPage=0),this.setGridFilters(i),this.checkData()}get preview(){return this.options.reportPreview}init(){this.reportingGrid=null,this.storageService=new v.default(this.reportingId,!0);let{collapsePanel:i,theme:w,title:m}=this.reportingConfig.controlsSettings||{};return this.component.components=[s.default.getControlsTabsComponet({tabs:this.getTabs(),collapsePanel:i,title:m,theme:w})],this.preview||(this.on(this.controlsEvents.applyColumns,()=>{this.onApplyColumns()}),this.on(this.controlsEvents.clearFilters,()=>{let d=this.getComponent(s.default.reportingControlsConfig.filtersCompKey);a._.each(this.filterSettings,C=>{C.set=!1}),d&&(d.resetValue(),d.redraw()),this.setGridFilters({}),this.storageService.saveData({filters:{}})}),this.on(this.controlsEvents.filter,()=>{this.onApplyFilters()}),this.on(this.controlsEvents.performAction,()=>{let{actions:d=[]}=this.reportingConfig,C=this.data.action,A=a._.get(d,C,null);A&&this.executeAction(A)})),super.init()}}},608:function(U,o,u){"use strict";var P,x;Object.defineProperty(o,"__esModule",{value:!0});let l=u(328),a=u(648),v=l.Components.components.editgrid,s=u(216),i=u(552),w=u(944),m=u(288),d=u(160),C="https://cdn.form.io",A="https://cdn.test-form.io";!((P=l.Formio.cdn)===null||P===void 0)&&P.baseUrl||l.Formio.cdn.setBaseUrl(C),((x=l.Formio.cdn)===null||x===void 0?void 0:x.baseUrl)===C&&(l.Formio.version||"").includes("rc")&&l.Formio.cdn.setOverrideUrl("grid",A),o.default=class extends v{static schema(...p){return v.schema({type:"reportinggrid",label:"Reporting Grid",key:m.default.reportingGridConfig.gridKey},...p)}static get builderInfo(){return{}}constructor(...p){super(...p),this.columns={},this.initComponents=[],this.type="reportinggrid",this.tabIndex=0;let y=new Promise((E,T)=>{this.reportingGridReady={resolve:E,reject:T}});this.reportingGridReady.promise=y}get dataReady(){var p;return(p=this.reportingGridReady)===null||p===void 0?void 0:p.promise}get reportingConfig(){var p,y;return((y=(p=this.root.form)===null||p===void 0?void 0:p.report)===null||y===void 0?void 0:y.data)||{}}get reportingForms(){return this.root.reportingForms||[]}get reportingId(){var p,y;return(y=(p=this.root.form)===null||p===void 0?void 0:p.report)===null||y===void 0?void 0:y._id}get visibility(){return i._.mapValues(this.columns,p=>!(p.hidden&&!p.hideColumnByDefault||p.hideColumnByDefault))}get fetchProvider(){let p=new s.default({reportingConfig:this.reportingConfig,formio:this.root.formio,dataDeconstructions:this.dataDeconstructionPathes});if(this.reportingConfig.enableControls){let y=this.storageService.getData("filters.grid");y&&(p.defaultFilters=y)}return p}get iteratableRows(){return[]}addReportingColumnProperties(p,y){var E;p.reportingSettings=y,p.hideColumnByDefault=!this.isDefaultColumn(y);let{path:T,formId:g,key:b}=y;p.columnWeight=i._.findIndex(((E=this.reportingConfig)===null||E===void 0?void 0:E.availableColumns)||[],_=>{let{path:H,formId:I}=_.column;return g?i._.isEqual(g,I)&&i._.isEqual(T,H):i._.isEqual(H,b)})}getCalculatedColumnSchema(p){let y=m.default.convertReportingCalcSettingsIntoGridComp(p,this.reportingConfig);return this.addReportingColumnProperties(y,p),y}formatGridComponent(p,y){let E=m.default.convertReportingFormCompIntoGridComp(p,y);return this.addReportingColumnProperties(E,y),E}isDefaultColumn(p){let{defaultColumns:y=[]}=this.reportingConfig;if(!y.length)return!0;let{formId:E,path:T,key:g}=p;return i._.some(y,b=>E?i._.isEqual(E,b.formId)&&i._.isEqual(T,b.path):i._.isEqual(b.path,g))}addColumnsFromReportingForms(p,y){i._.each(this.reportingForms,E=>{let T=i._.get(y,E._id,[]);i._.each(T,g=>{let b=g.default?i._.get(i._.find(m.default.defaultColumns,_=>_.path===g.path),"component",null):l.Utils.getComponent(E.components,g.path,!1);b&&p.push(this.formatGridComponent(b,g))})})}checkDeconstructions(p){if(!p)return;let{formId:y,path:E,operator:T}=p;T?i._.each(m.default.getCalcOperatorFieldArgs(p)||[],g=>{g&&this.checkDeconstructionRequirement(g.formId,g.path)}):this.checkDeconstructionRequirement(y,E)}checkDeconstructionRequirement(p,y){if(!p||!y)return;let E=this.dataDeconstructionPathes[p]||[],T=i._.find(E,({path:g=""})=>i._.startsWith(y,g+"."));T&&(T.unwind=!0)}addCalculatedColumns(p,y=[],E){i._.each(y,T=>{E&&!i._.includes(E,T.key)||p.push(this.getCalculatedColumnSchema(T))})}init(){this.storageService=new w.default(this.reportingId,this.reportingConfig.enableControls),this.dataDeconstructionPathes={},i._.each(this.reportingForms,I=>{if(!I||!I.components)return;let O=[];l.Utils.eachComponent(I.components,(R,S)=>{R&&i._.includes(["datagrid","editgrid"],R.type)&&O.push({path:S})},!0),this.dataDeconstructionPathes[I._id]=O});let{availableColumns:p=[],calculatedColumns:y=[],groups:E={},title:T,gridSettings:g={},actions:b=[]}=this.reportingConfig,{calculatedColumns:_=[]}=E;i._.assign(this.component,g);let H=[];if(p.length){let I=[],O=i._.chain(p).map(S=>{let{column:j,displayTitle:M}=S,{path:V,formId:N}=j;return V&&N?(this.checkDeconstructions(j),Object.assign(Object.assign({},j),{displayTitle:M})):(V&&!N&&I.push(V),null)}).filter(S=>!!S).groupBy("formId").value(),R=[...y,..._];i._.each(R,S=>this.checkDeconstructions(S)),this.addColumnsFromReportingForms(H,O),this.addCalculatedColumns(H,R,I)}return this.component.label=T,this.component.components=H,super.init()}render(){return super.render(this.renderTemplate("reportingGrid"))}attach(p){let y=this.reportingGridReady,E=new Promise((T,g)=>{this.reportingGridReady={resolve:T,reject:g}}).then(()=>{y&&y.resolve()});return this.reportingGridReady.promise=E,super.attach(p).then(()=>{if(this.loadRefs(this.element,{reportingGridContainer:"single"}),this.formioGrid&&this.refs.reportingGridContainer)return this.formioGrid.init(),this.formioGrid.attach(this.refs.reportingGridContainer),void this.reportingGridReady.resolve();this.loadFormioGrid().then(T=>this.initFormioGrid(T).then(()=>{this.reportingGridReady.resolve()}))})}loadFormioGrid(){let p=""+l.Formio.cdn.grid+([C,A].some(y=>i._.startsWith(l.Formio.cdn.grid,y))?"/v2":"");return l.Formio.requireLibrary("FormioGrid","FormioGrid",[{type:"script",src:p+"/formio.grid.min.js"},{type:"styles",src:p+"/formio.grid.min.css"}],!0)}attachComponent({key:p,element:y,value:E,onChange:T,rowIndex:g,row:b,index:_,readOnly:H}){let I=this.columns[p];if(I){I=Object.assign(Object.assign({},I),{hideLabel:!0,hidden:!1,type:I.type==="hidden"?"textfield":I.type,disabled:!1});let O=Object.assign(Object.assign({},this.options),{onChange:(S,j,M)=>{M&&(T?.(j.value),j.instance.checkComponentValidity())},readOnly:H}),R=this.createComponent(I,O,{[p]:E},!1,!0);return R.rowIndex=_??R.rowIndex,R.data=b??R.data,R.build(y),{component:R,resetValue:()=>{R.resetValue()}}}return null}customFilters(p){return a.filterByComponentType[p?.type]}getGridColumns(){let p=this.component.components||[];return i._.chain(p).map(y=>{let E=Object.assign({sortable:!0,filterable:!0,show:!y.hideColumnByDefault},y);return this.columns[E.key]=E,E}).sortBy("columnWeight").value()}get preview(){return this.options.reportPreview}initFormioGrid(p){var y,E,T;let{disabled:g,cellMaxWidth:b,itemsPerPage:_,hideLabel:H}=this.component,{readOnly:I,pdf:O=!1}=this.options;this.initComponents=this.createRowComponents({},0);let R={components:this.getGridColumns(),fetch:{enableFetch:!this.preview,url:((y=this.root.formio)===null||y===void 0?void 0:y.projectUrl)+"/report"},hideLabel:H,enableRowSelect:!!(!((T=(E=this.reportingConfig)===null||E===void 0?void 0:E.actions)===null||T===void 0)&&T.length),pagination:{itemsPerPage:_||10},cellMaxWidth:b,showAddBtn:!1},{sort:S,filters:j,columns:M}=this.storageService.getAllData()||{};return S&&(R.sort=S),!this.reportingConfig.enableControls&&j&&(R.filters=j),M&&M.length&&i._.each(R.components,V=>{V.show=i._.includes(M,V.key)}),p.render(this.refs.reportingGridContainer,R,{sortable:!0,filterable:!0,readOnly:this.preview||I||g,fetchProvider:this.fetchProvider,hideMenu:this.reportingConfig.enableControls,hooks:{attachFilter:this.attachComponent.bind(this),format:(V,N)=>this.format(V,N),filter:V=>this.customFilters(this.columns[V]),transformData:V=>this.transformFetchedData(V)},pdf:O},this.dataValue).then(V=>{this.formioGrid=V,this.preview||(this.formioGrid.on("rowClick",(N,ie,ne,de)=>{this.emit("rowClick",N,ie,ne,this)}),this.formioGrid.on("rowSelectChange",N=>{this.selectedRows=N,this.emit("rowSelectChange",N,this)}),this.formioGrid.on("fetchDataError",N=>{this.root.setAlert("danger",this.t("Fetch Data Error.")+" "+(N&&JSON.stringify(N))),this.emit("fetchDataError",N,this)}),this.formioGrid.on("page",(N,ie)=>{if(!this.preview)if(this.reportingConfig.enableControls){let{sort:ne={}}=this.formioGrid.component;this.storageService.saveData({sort:ne})}else{let{sort:ne={},filters:de={},components:me=[]}=this.formioGrid.component;this.storageService.saveData({sort:ne,filters:de,columns:i._.chain(me).filter(he=>he.show).map(he=>he.key).value()})}this.emit("page",N,this,ie)}),this.formioGrid.on("changeItemsPerPage",N=>{this.emit("changeItemsPerPage",N)}))})}transformFetchedData(p){return p=p||[],i._.each(this.component.components||[],y=>{let{reportingSettings:E={}}=y,T=E.operator;T&&d.default[T]&&d.default[T].transformResponse&&i._.each(p,g=>{let b=i._.get(g,y.key);i._.set(g,y.key,new d.default[T]().transformServerValue(b,E))}),i._.isInteger(E.decimalLimit)&&i._.each(p,g=>{let b=i._.get(g,y.key);i._.isNumber(b)&&i._.set(g,y.key,i._.round(b,E.decimalLimit))})}),p}createRowComponents(p,y){let E=super.createRowComponents(p,y);return this.disabled&&E.forEach(T=>{T.disabled=!0}),E}createComponent(p,y,E,T,g){let b=super.createComponent(p,y,E,T);if(g){let{visibility:_}=this;_.hasOwnProperty(p.key)&&b.visible!==_[p.key]&&(b.visible=_[p.key])}return b}format(p,y){let E=this.columns[p];return E?(l.Utils.getComponent(this.initComponents,p,!0)||l.Components.create(E,this.options,y)).getView(y):y}setValue(p){this.dataValue=p}destroy(){var p,y;super.destroy(),this.emit("destroy"),(y=(p=this.formioGrid)===null||p===void 0?void 0:p.destroy)===null||y===void 0||y.call(p)}}},648:function(U,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.filterByComponentType=void 0,o.filterByComponentType={select:[{type:"equal",label:"Is equal to",filter:()=>""},{type:"notEqual",label:"Is not equal to",filter:()=>""},{type:"contain",label:"Contains",filter:()=>""},{type:"notContain",label:"Does not contain",filter:()=>""}],checkbox:[{type:"equal",label:"Is equal to",filter:()=>""}]}},736:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(608),x=u(92);o.default={reportingcontrols:x.default,reportinggrid:P.default}},227:function(U,o,u){"use strict";var P=this&&this.__awaiter||function(i,w,m,d){return new(m||(m=Promise))(function(C,A){function p(T){try{E(d.next(T))}catch(g){A(g)}}function y(T){try{E(d.throw(T))}catch(g){A(g)}}function E(T){var g;T.done?C(T.value):(g=T.value,g instanceof m?g:new m(function(b){b(g)})).then(p,y)}E((d=d.apply(i,w||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});let x=u(192),l=u(0),a=u(328),v=new x.OfflineLibraryLicense(l.default),s=i=>P(void 0,void 0,void 0,function*(){if(!a.Formio.license)throw new Error(`You need to set the license key in order to use the '@formio/reporting' library. 
 You can do it this way: Formio.license = "YourLicenseKey";`);yield i()});o.default={checkLicense:()=>P(void 0,void 0,void 0,function*(){try{yield s(()=>v.verify(window.Formio.license,!0))}catch(i){if(!i.softFailLicenseExpiration)throw i;console.error(i.message)}}),checkEndpointAllowed:i=>P(void 0,void 0,void 0,function*(){return yield s(()=>v.checkAllowedEndpoints(i,a.Formio.license))})}},916:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.checkEndpointAllowed=o.checkLicense=void 0;let P=u(227);o.checkLicense=P.default.checkLicense,o.checkEndpointAllowed=P.default.checkEndpointAllowed},216:function(U,o,u){"use strict";var P=this&&this.__awaiter||function(i,w,m,d){return new(m||(m=Promise))(function(C,A){function p(T){try{E(d.next(T))}catch(g){A(g)}}function y(T){try{E(d.throw(T))}catch(g){A(g)}}function E(T){var g;T.done?C(T.value):(g=T.value,g instanceof m?g:new m(function(b){b(g)})).then(p,y)}E((d=d.apply(i,w||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});let x=u(328),l=u(552),a=u(288),v=u(160),s=u(916);o.default=class{constructor(i){this.options=i,this.defaultFilters={}}get reportingUrl(){var i;return((i=this.options.formio)===null||i===void 0?void 0:i.projectUrl)+"/report"}get requestHeaders(){return[{key:"Content-Type",value:"application/json"}]}get requestMethod(){return"POST"}getRequestHeaders(){let i=new x.Formio.Headers;if(!l._.isEmpty(this.requestHeaders))try{l._.each(this.requestHeaders,w=>{w.key&&i.set(w.key,w.value)})}catch(w){console.warn(w.message)}return i}getAggregatedRequestFilterQuery(i,w){let{value:m=null,comparedValue:d=null}=w,C=a.default.filtersQueries;if(!m&&!l._.includes([C.empty,C.notEmpty,C.exist,C.notExist],i))return null;let A=m;switch(i){case C.equal:return{[A]:{$eq:d}};case C.notEqual:return{[A]:{$ne:d}};case C.startsWith:return{[A]:{$regex:"^"+d,$options:"i"}};case C.contain:return{[A]:{$regex:d,$options:"i"}};case C.notContain:return{[A]:{$regex:"^((?!"+d+").)*$",$options:"i"}};case C.endsWith:return{[A]:{$regex:d+"$",$options:"i"}};case C.matches:return{[A]:{$regex:d,$options:"i"}};case C.greaterThen:return{[A]:{$gt:d}};case C.greaterThenOrEqual:return{[A]:{$gte:d}};case C.lessThen:return{[A]:{$lt:d}};case C.lessThenOrEqual:return{[A]:{$lte:d}};case C.exist:return{[A]:{$exists:!0}};case C.notExist:return{[A]:{$exists:!1}};case C.empty:return l._.isNull(d)||l._.isUndefined(d)?{[A]:null}:{$or:[{[A]:null},{[A]:{$eq:d}}]};case C.notEmpty:return l._.isNull(d)||l._.isUndefined(d)?{[A]:{$ne:null}}:{$and:[{[A]:{$ne:null}},{[A]:{$ne:d}}]};default:return null}}addDataDeconscructionStages(i,w,m){let d=this.options.dataDeconstructions||{},C=l._.get(d,w,[]);l._.each(C,({path:A,unwind:p})=>{p&&i.push({$unwind:{path:"$"+m+".data."+A,preserveNullAndEmptyArrays:!0}})})}getAggregatedRequestBody(i={}){let{reportingConfig:w={}}=this.options,{connections:m=[],calculatedColumns:d=[],groups:C={},availableColumns:A=[],forms:p=[]}=w;i=l._.mergeWith(i,this.defaultFilters,(O,R)=>{if(l._.isArray(O))return l._.concat(O,R)});let y=[];if(p.length===1){let O=p[0];y.push({$match:{form:{$in:[O]}}});let R=a.default.getJoinedFormDataPathInJoinedObj(O),S={[R+".data"]:"$data",[R+"._id"]:"$_id"};l._.each(a.default.defaultColumns,j=>{j.submissionRootPath&&(S[R+"."+j.path]="$"+j.path)}),y.push({$project:S}),this.addDataDeconscructionStages(y,O,R)}p.length>1&&m.length&&l._.each(m,(O,R)=>{let{baseForm:S,baseFormField:j,joiningForm:M,joiningFormField:V,baseFormValuePath:N,joiningFormValuePath:ie}=O,ne=a.default.getJoinedFormDataPathInJoinedObj(S);if(R===0){y.push({$match:{form:{$in:[S]}}});let ye={[ne+".data"]:"$data",[ne+"._id"]:"$_id"};l._.each(a.default.defaultColumns,we=>{we.submissionRootPath&&(ye[ne+"."+we.path]="$"+we.path)}),y.push({$project:ye}),this.addDataDeconscructionStages(y,S,ne)}let de=a.default.getJoinedFormDataPathInJoinedObj(M),me=j===a.default.connectionByFullSubmissionObjectOptionValue,he=V===a.default.connectionByFullSubmissionObjectOptionValue,Ne={data:1,_id:1};l._.each(a.default.defaultColumns,ye=>{ye.submissionRootPath&&(Ne[ye.path]=1)}),y.push({$lookup:{from:"submissions",localField:me?ne+"._id":ne+".data."+j+(N?"."+N:"")+(he?"._id":""),foreignField:he?"_id":"data."+V+(ie?"."+ie:"")+(me?"._id":""),as:de}}),y.push({$addFields:{[""+de]:{$filter:{input:"$"+de,as:"item",cond:{$eq:["$$item.form","ObjectId('"+M+"')"]}}}}}),y.push({$unwind:{path:"$"+de,preserveNullAndEmptyArrays:!0}}),this.addDataDeconscructionStages(y,M,de)}),d.length&&l._.each(d,O=>{let R=l._.get(v.default,O.operator,null),{key:S}=O;if(R){let j=new R().getRequest(O);if(j){let M={};M[a.default.getDataPath({path:S})]=j,y.push({$addFields:M})}}});let{groupingFields:E=[],calculatedColumns:T=[]}=C||{},g=E.length;if(g){let O={},R={};l._.each(E,j=>{let{path:M}=j.field,V=l._.camelCase(M),N=a.default.getDataPath(j.field);l._.set(O,V,"$"+N),l._.set(R,N,"$_id."+V)});let S={_id:O};l._.each(T,j=>{let M=l._.get(v.default,j.operator,null),{key:V}=j;if(M){let N=new M,ie=N.getGroupRequest(j,O);if(ie){S[V]=ie;let ne=N.getGroupProjectRequest(j);l._.set(R,a.default.getDataPath({path:V}),ne||"$"+V)}}}),y.push({$group:S}),y.push({$project:R})}let b=l._.chain(i).map((O,R)=>l._.isArray(O)?l._.map(O,S=>this.getAggregatedRequestFilterQuery(R,S)):null).flatten().filter(O=>!!O).value();if(l._.isEmpty(b)||y.push({$match:{$and:b}}),A.length){let O={};!g&&p.length&&l._.each(p,R=>l._.set(O,a.default.getJoinedFormDataPathInJoinedObj(R)+"._id",1)),l._.each(A,R=>{l._.set(O,a.default.getDataPath(R.column),1)}),y.push({$project:O})}let{limit:_,skip:H,sort:I}=i;if(!l._.isEmpty(I)){let{value:O,asc:R}=I;y.push({$sort:{[""+O]:R?1:-1}})}return H&&y.push({$skip:H}),_&&y.push({$limit:_}),y}makeRequest(i){return P(this,void 0,void 0,function*(){let w=this.reportingUrl,m=this.options.formio;if(w&&m&&m.makeRequest){try{yield(0,s.checkEndpointAllowed)(w)}catch(d){alert(d.message)}return m.makeRequest(l._.camelCase("report "+l._.get(this.options,"reportingConfig.name","")),w,this.requestMethod,this.getAggregatedRequestBody(i),{headers:this.getRequestHeaders(),noToken:!1,ignoreCache:!l._.get(this.options.reportingConfig,"gridSettings.allowCaching",!1)})}})}getData(i){i=i||{};try{return this.makeRequest(i)}catch(w){console.error("Reporting Grid Request Error: "+w)}}}},944:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(552);o.default=class{constructor(x,l){this.storageKey="reporting"+(l?"Controls":"")+"-"+x}saveData(x){if(localStorage){let l=this.getAllData()||{};localStorage.setItem(this.storageKey,JSON.stringify(Object.assign(Object.assign({},l),x)))}}getAllData(){if(localStorage)try{return JSON.parse(localStorage.getItem(this.storageKey))}catch{return null}return null}getData(x){if(localStorage&&x){let l=this.getAllData()||{};return P._.get(l,x,null)}return null}}},732:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(128);o.default={reportingGrid:P.default}},896:function(U,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(u){return'<div ref="reportingGridContainer"></div>'}},128:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(896);o.default={form:P.default}},8:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(732);o.default={bootstrap:P.default,bootstrap3:P.default,bootstrap4:P.default,semantic:P.default}},152:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(552);o.default=class{static get operatorKey(){return""}static getDisplayField(x,l){return{type:"textfield"}}static getFieldArgs(x){return P._.chain(["argument",...this.calculationArgs]).map(l=>P._.get(x,l)).flatten().filter(l=>l&&P._.isObject(l)).value()}static get acceptedValueTypes(){return[]}static get operatorTitle(){return""}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!1}static get calculationArgs(){return[]}static get transformResponse(){return!1}getRequest(x){return null}getGroupRequest(x,l){return null}getGroupProjectRequest(x){return null}transformServerValue(x,l){return x}}},876:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"avg"}static get operatorTitle(){return"Average"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedGroupOperator(){return!0}static get aggregatedCalculationOperator(){return!1}static get calculationArgs(){return["date","decimalLimit"]}getGroupRequest(v){let{argument:s}=v;return{$avg:"$"+(0,x.getDataPath)(s)}}}o.default=l},80:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"concat"}static getDisplayField(s){return{type:"textfield"}}static getFieldArgs(s){let i=x._.get(s,"concatArgs",[]);return x._.chain(i).map(w=>x._.get(w,"field")).filter(w=>w&&x._.isObject(w)).value()}static get operatorTitle(){return"Concatenate Strings"}static get acceptedValueTypes(){return[x.valueTypes.string]}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["concatArgs"]}getRequest(s){let{concatArgs:i=[]}=s,w=i.length;return{$concat:l.Utils._.chain(i).map((m,d)=>{let{field:C,connector:A}=m,p="$"+(0,x.getDataPath)(C);return d===w-1?p:[p,A||" "]}).flatten().value()}}}o.default=a},96:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(552),x=u(152);class l extends x.default{static get operatorKey(){return"count"}static getDisplayField(v,s){return(0,P.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Count"}static get aggregatedGroupOperator(){return!0}static get aggregatedCalculationOperator(){return!1}static get acceptedValueTypes(){return[P.valueTypes.any]}getGroupRequest(v,s){return{$push:s}}getGroupProjectRequest(v){return{$size:"$"+v.key}}}o.default=l},324:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"dateDiff"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static getFieldArgs(s){let{startDate:i,endDate:w}=s||{};return x._.chain([i,w]).filter(m=>m&&x._.isObject(m)).value()}static get operatorTitle(){return"Dates Difference"}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get unitOptions(){return["years","weeks","months","days","hours","minutes","seconds","milliseconds"]}static get calculationArgs(){return["dateDiffArgs"]}static get transformResponse(){return!0}transformServerValue(s,i){let{unit:w}=i,{endDate:m,startDate:d}=s||{},C=l.Utils.moment;if(d&&m)return C(m).diff(C(d),w!=="milliseconds"&&w?w:null)}getRequest(s){let{endDate:i,startDate:w}=s;return{startDate:"$"+(0,x.getDataPath)(w),endDate:"$"+(0,x.getDataPath)(i)}}}o.default=a},336:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"dayOfMonth"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Day Of Month"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$dayOfMonth:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},164:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"dayOfWeek"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Day Of Week"}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$dayOfWeek:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},240:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"dayOfYear"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Day Of Year"}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get acceptedValueTypes(){return[x.valueTypes.date]}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$dayOfYear:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},728:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"divide"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static getFieldArgs(v){let{divisor:s,dividend:i}=v;return x._.chain([s,i]).filter(w=>w&&x._.isObject(w)).value()}static get operatorTitle(){return"Divide"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["decimalLimit","divideArgs"]}getRequest(v){let{divisor:s,dividend:i}=v;return{$cond:[{$eq:["$"+(0,x.getDataPath)(s),0]},"",{$divide:["$"+(0,x.getDataPath)(i),"$"+(0,x.getDataPath)(s)]}]}}}o.default=l},832:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"max"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Max"}static get aggregatedGroupOperator(){return!0}static get aggregatedCalculationOperator(){return!1}static get calculationArgs(){return["decimalLimit"]}static get acceptedValueTypes(){return[x.valueTypes.number]}getGroupRequest(v){let{argument:s}=v;return{$max:"$"+(0,x.getDataPath)(s)}}}o.default=l},660:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"min"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Min"}static get aggregatedGroupOperator(){return!0}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedCalculationOperator(){return!1}static get calculationArgs(){return["decimalLimit"]}getGroupRequest(v){let{argument:s}=v;return{$min:"$"+(0,x.getDataPath)(s)}}}o.default=l},536:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"month"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Month Number"}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$month:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},284:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"multiply"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Multiply"}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedGroupOperator(){return!1}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["args","decimalLimit"]}getRequest(v){let{args:s=[]}=v;return{$multiply:x._.map(s,i=>"$"+(0,x.getDataPath)(i))}}}o.default=l},144:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"percentage"}static getDisplayField(v){return(0,x.getAggrOperatorNumberField)(v)}static get operatorTitle(){return"Percentage"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["arg"]}getRequest(v){let{arg:s}=v;return{$multiply:[s?"$"+(0,x.getDataPath)(s):0,100]}}}o.default=l},928:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"size"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Array Size"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.array]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["arg"]}getRequest(v){let{arg:s}=v,i="$"+(0,x.getDataPath)(s);return{$cond:{if:{$isArray:i},then:{$size:i},else:0}}}}o.default=l},764:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"subtract"}static getDisplayField(v){return(0,x.getAggrOperatorNumberField)(v)}static get operatorTitle(){return"Subtract"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.number]}static get aggregatedCalculationOperator(){return!0}static getFieldArgs(v){let{minuend:s,subtrahend:i}=v||{};return x._.chain([s,i]).filter(w=>w&&x._.isObject(w)).value()}static get calculationArgs(){return["decimalLimit","subtractArgs"]}getRequest(v){let{minuend:s,subtrahend:i}=v;return{$subtract:["$"+(0,x.getDataPath)(s),"$"+(0,x.getDataPath)(i)]}}}o.default=l},12:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552);class l extends P.default{static get operatorKey(){return"sum"}static getDisplayField(v,s){return(0,x.getAggrOperatorNumberField)(v,s)}static get operatorTitle(){return"Sum"}static get aggregatedGroupOperator(){return!0}static get aggregatedCalculationOperator(){return!0}static get acceptedValueTypes(){return[x.valueTypes.number]}static get calculationArgs(){return["args","decimalLimit"]}getRequest(v){let{args:s}=v;return{$sum:x._.map(s,i=>"$"+(0,x.getDataPath)(i))}}getGroupRequest(v){let{argument:s}=v;return{$sum:"$"+(0,x.getDataPath)(s)}}}o.default=l},576:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"week"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Week Number"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$week:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},624:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(152),x=u(552),l=u(328);class a extends P.default{static get operatorKey(){return"year"}static getDisplayField(s,i){return(0,x.getAggrOperatorNumberField)(s,i)}static get operatorTitle(){return"Year"}static get aggregatedGroupOperator(){return!1}static get acceptedValueTypes(){return[x.valueTypes.date]}static get aggregatedCalculationOperator(){return!0}static get calculationArgs(){return["date"]}getRequest(s){let{date:i}=s;return{$year:{date:"$"+(0,x.getDataPath)(i),timezone:l.Utils.currentTimezone()}}}}o.default=a},160:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(624),x=u(324),l=u(728),a=u(284),v=u(12),s=u(96),i=u(832),w=u(660),m=u(876),d=u(80),C=u(928),A=u(536),p=u(576),y=u(336),E=u(164),T=u(240),g=u(764),b=u(144),_={[""+P.default.operatorKey]:P.default,[""+x.default.operatorKey]:x.default,[""+l.default.operatorKey]:l.default,[""+a.default.operatorKey]:a.default,[""+s.default.operatorKey]:s.default,[""+v.default.operatorKey]:v.default,[""+i.default.operatorKey]:i.default,[""+w.default.operatorKey]:w.default,[""+m.default.operatorKey]:m.default,[""+d.default.operatorKey]:d.default,[""+C.default.operatorKey]:C.default,[""+A.default.operatorKey]:A.default,[""+p.default.operatorKey]:p.default,[""+y.default.operatorKey]:y.default,[""+E.default.operatorKey]:E.default,[""+T.default.operatorKey]:T.default,[""+g.default.operatorKey]:g.default,[""+b.default.operatorKey]:b.default};o.default=_},132:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(328),x=u(988),l=P.Utils.ConditionOperators,a={dateGreaterThan:x.default.greaterThen,dateGreaterThanOrEqual:x.default.greaterThenOrEqual,dateLessThan:x.default.lessThen,dateLessThanOrEqual:x.default.lessThenOrEqual,endsWith:x.default.endsWith,greaterThan:x.default.greaterThen,greaterThanOrEqual:x.default.greaterThenOrEqual,includes:x.default.contain,isDateEqual:x.default.equal,isEmpty:x.default.empty,isEqual:x.default.equal,isNotDateEqual:x.default.notEqual,isNotEmpty:x.default.notEmpty,isNotEqual:x.default.notEqual,lessThan:x.default.lessThen,lessThanOrEqual:x.default.lessThenOrEqual,notIncludes:x.default.notContain,startsWith:x.default.startsWith};P.Utils._.each(l,(v,s)=>{let i=a[s];i&&Object.defineProperty(v,"filterKey",{enumerable:!0,configurable:!0,get(){return i}})}),o.default=l},276:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.getFilterOperatorOptions=v,o.getFilterOperatorsOptionsForCompType=s,o.getControlsFilterOperators=function(g,b=[],_=[]){var H;if(!g||a._.isEmpty(g))return[];let{formId:I,path:O,default:R}=g,S="base";if(I&&!R){let j=a._.find(b,V=>V._id===I),M=P.Utils.getComponent(j?j.components:[],O,!1);S=M?.type||S}if(I&&R&&(S=a._.get(a._.find(a.defaultColumns,j=>j.path===O),"component.type",null)||S),!I&&O){let j=a._.find(_,N=>N.key===O),{operator:M=""}=j||{},V=x.default[M];S=V?(H=V.getDisplayField(j))===null||H===void 0?void 0:H.type:S}return s(S)},o.getUnselectedColumnsOptions=i,o.getReportingFormAsOption=w,o.getConnectionBaseFormOptions=function(g=[],b=[],_){if(_){let H=a._.slice(b,0,_),I=[];a._.each(H,(R,S)=>{I.push(R.joiningForm),I.push(R.baseForm)});let O=a._.map(g,R=>a._.includes(I,R._id)?w(R):null);return a._.filter(O,R=>!!R)}return a._.map(g,H=>w(H))},o.getConnectionJoiningFormOptions=function(g=[],b=[],_){let H=a._.slice(b,0,_+1),I=[];a._.each(H,(R,S)=>{I.push(R.baseForm),S!==_&&I.push(R.joiningForm)});let O=a._.map(g,R=>a._.includes(I,R._id)?null:w(R));return a._.filter(O,R=>!!R)},o.getConnectionFormComponentsAsOptions=function(g,b=[]){let _=a._.find(b,O=>O._id===g),H=_?_.components:[],I=[{label:"Submission Object (*)",value:a.connectionByFullSubmissionObjectOptionValue}];return P.Utils.eachComponent(H,(O,R)=>(m(O)||I.push({label:O.label+" ("+R+")",value:R}),d(O))),I},o.getAggregationOperatorsOptions=function(g=!1){return a._.chain(x.default).map(b=>(g?b.aggregatedGroupOperator:b.aggregatedCalculationOperator)?{value:b.operatorKey,label:b.operatorTitle}:null).filter(b=>!!b).sortBy("label").value()},o.getReportingFormComponentAsOption=C,o.getReportingFormsComponentsAsOptions=p,o.getCalculatedColumnAsOption=y,o.addCalculatedColumnsOptions=E,o.getCalculationArgsOptions=function(g=[],b=[],_=null,H){return T({reportingForms:g,calculatedColumns:a._.slice(b,0,H),selectedItems:[],operator:_})},o.getReportingFormsComponentsAndExtraComponentsAsOptions=T,o.getColumnsListOptions=function(g=[],b,_){let{groupingFields:H,calculatedColumns:I}=b||{},O=a._.some(H||[],S=>S.field&&S.field.path),R=[];if(O){let S=[],j=a._.chain(H).map(M=>{let{path:V,formId:N}=M.field;return V&&N?{path:V,formId:N}:(V&&!N&&S.push(V),null)}).filter(M=>!!M).groupBy("formId").value();a._.each(g,M=>{let V=a._.get(j,M._id,[]);a._.each(V,N=>{let ie=P.Utils.getComponent(M.components,N.path,!1);ie&&R.push(C(M,ie,N.path))})}),a._.each(_,M=>{a._.includes(S,M.key)&&R.push(y(M))}),E({calculatedColumns:I,options:R})}else a._.each(g,S=>{P.Utils.eachComponent(S.components,(j,M)=>(m(j,null,!0)||R.push(C(S,j,M)),d(j))),R=a._.concat(R,A(S))}),E({calculatedColumns:_,options:R});return R},o.getAvailableColumnsAsOptions=function(g,b){let _=[];return a._.each(g||[],H=>{_.push(H.column)}),a._.filter(b,H=>a._.some(_,I=>a._.isEqual(I,H.value)))},o.getCustomScriptAvailableVarialbles=function(){return'<p>The following variables are available in all scripts.</p><table class="table table-bordered table-condensed table-striped"><tr><th>reporting</th><td>The Reporting UI configuration object.</td></tr><tr><th>selectedRows</th><td>The array of selected rows data.</td></tr><tr><th>reportingForms</th><td>The complete JSON objects of the Reporting UI source forms.</td></tr><tr><th>reportingControls</th><td>The instance of the Reporting Controls component.</td></tr><tr><th>reportingGrid</th><td>The instance of the Reporting Grid component.</td></tr><tr><th>moment</th><td>The moment.js library for date manipulation.</td></tr><tr><th>_</th><td>An instance of <a href="https://lodash.com/docs/" target="_blank">Lodash</a>.</td></tr><tr><th>utils</th><td>An instance of the <a href="http://formio.github.io/formio.js/docs/identifiers.html#utils" target="_blank">FormioUtils</a> object.</td></tr><tr><th>util</th><td>An alias for "utils".</td></tr></table><br/>'},o.getDateDiffUnitOptions=function(g){return g?a._.map(x.default[g].unitOptions||[],b=>({label:b,value:b})):[]},o.showAggregationOperatorArg=function(g,b){if(!b||!g)return!1;let _=x.default[b];return!!_&&a._.some(_.calculationArgs||[],H=>H===g)},o.showGroupOperatorArg=function(g){return g&&!a._.includes(["count"],g)},o.getReportTypeInfo=function(g,b){var _,H,I,O,R;let S=!((_=g.forms)===null||_===void 0)&&_.length?!!(!((I=(H=g.groups)===null||H===void 0?void 0:H.groupingFields)===null||I===void 0)&&I.length):null;return{grouping:S,typeChanged:a._.isBoolean((O=b.dataValue)===null||O===void 0?void 0:O.grouping)&&!a._.isEqual(S,(R=b.dataValue)===null||R===void 0?void 0:R.grouping)}};let P=u(328),x=u(160),l=u(132),a=u(552);function v(g=[]){return a._.chain(g).map(b=>{let _=l.default[b];return _?{label:_.displayedName,value:_.operatorKey}:null}).filter(b=>!!b).value()}function s(g){var b;let _=(b=P.Formio.Components)===null||b===void 0?void 0:b.components[g];return v(_&&_.conditionOperatorsSettings?_.conditionOperatorsSettings.operators:[])}function i(g,b){return a._.filter(g,_=>!a._.some(b,H=>a._.isEqual(H,_.value)))}function w(g){return{label:g?.title,value:g?._id}}function m(g,b,_){if(g=g||{},a._.includes(["button","form","datasource"],g.type))return!0;let H=P.Formio.Components.components[g.type],I=H?H.schema(g):null,O=H&&H.savedValueTypes?H.savedValueTypes(I||g):[];if(_){let R=P.Formio.Components.components.nesteddata;if(a._.includes(["sketchpad"],g.type)||H&&R&&H.prototype instanceof R&&!a._.includes(["address"],g.type))return!0}if(a._.isEmpty(O))return!0;if(a._.includes(O,a.valueTypes.any))return!1;if(b){if(a._.includes(["signature"],g.type))return!0;let R=x.default[b],S=R&&R.acceptedValueTypes&&!a._.isEmpty(R.acceptedValueTypes)?R.acceptedValueTypes:null;return!(!S||a._.includes(S,a.valueTypes.any)||a._.some(S,j=>a._.includes(O,j)))}return!1}function d(g){return!!a._.includes(["datamap","datatable","address","tagpad"],g.type)}function C(g,b,_){return{value:{path:_,formId:g._id},label:(b.label||b.key)+" ("+g.title+"/"+_+")"}}function A(g,b){let _=a.defaultColumns;return b&&(_=a._.filter(_,H=>!m(H.component,b))),a._.map(_,H=>({value:{path:H.path,formId:g._id,default:!0},label:H.path+" ("+g.title+")"}))}function p(g,b){let _=[];return a._.each(g,H=>{P.Utils.eachComponent(H.components,(I,O)=>(m(I,b)||_.push(C(H,I,O)),d(I))),_=a._.concat(_,A(H,b))}),_}function y(g){return{value:{path:g.key},label:g.name+" (*calculated)"}}function E({calculatedColumns:g=[],options:b,operator:_=null}){a._.each(g,H=>{let I=!0;if(_){let O=x.default[H.operator];O&&(I=!m(O.getDisplayField(H),_))}I&&b.push(y(H))})}function T({reportingForms:g=[],calculatedColumns:b=[],selectedItems:_=[],operator:H=null}){let I=p(g,H);return E({calculatedColumns:b,options:I,operator:H}),_.length?i(I,_):I}},296:function(U,o,u){"use strict";var P=this&&this.__awaiter||function(d,C,A,p){return new(A||(A=Promise))(function(y,E){function T(_){try{b(p.next(_))}catch(H){E(H)}}function g(_){try{b(p.throw(_))}catch(H){E(H)}}function b(_){var H;_.done?y(_.value):(H=_.value,H instanceof A?H:new A(function(I){I(H)})).then(T,g)}b((p=p.apply(d,C||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.getPDFDownloadUrl=o.reportingControlsConfig=void 0,o.getColumnsTab=function(){return{label:'<i class="fa fa-columns mr-1" aria-hidden="true"></i>Columns',key:"columnsControls",components:[{label:"Displayed Columns",hideLabel:!0,description:"Select the columns you want to display in the Reporting Grid.",widget:"choicesjs",multiple:!0,dataSrc:"custom",valueProperty:"value",dataType:"string",key:o.reportingControlsConfig.displayedColumnsCompKey,data:{custom({instance:d,_:C}){let A=d.root.getComponent(x.reportingGridConfig.gridKey),p=A?A.component.components:[];return C.map(p,y=>({label:y.label||y.key,value:y.key}))}},customDefaultValue({instance:d,_:C}){let A=d.root.getComponent(x.reportingGridConfig.gridKey),p=A?A.component.components:[];return C.chain(p).filter(y=>!y.hideColumnByDefault).map(y=>y.key).value()},type:"select",input:!0},{label:"Apply",action:"event",showValidations:!1,key:o.reportingControlsConfig.events.applyColumns,type:"button",event:o.reportingControlsConfig.events.applyColumns,input:!0}]}},o.getSingleFilterOperators=function(){return a._.chain(v.default).map(d=>d.requireValue?null:d.operatorKey).filter(d=>!!d).value()},o.getSingleFilterOperatorValueComp=function(d){return{widget:"choicesjs",data:{values:[{label:v.default[d].displayedName,value:"true"}]},dataType:"boolean",type:"select",input:!0}},o.getFilterSetStyleLogic=function(){return{name:"color bg on filter",trigger:{type:"javascript",javascript:"result = true;"},actions:[{name:"toggle filter-set class",type:"customAction",customAction:`
          var controls = instance.root.getComponent('`+o.reportingControlsConfig.controlsKey+`');
          controls.toggleFilterClass(instance);
        `}]}},o.getFilterColumns=i,o.getFiltersTab=function(d,C){return{label:'<i class="fa fa-filter mr-1" aria-hidden="true"></i>Filters',key:"filtersControls",components:[{label:"Filters",key:"filters",type:"container",input:!0,components:i(d,C)},{label:"Columns",columns:[{components:[{label:"Filter",action:"event",showValidations:!1,disableOnInvalid:!0,key:o.reportingControlsConfig.events.filter,type:"button",event:o.reportingControlsConfig.events.filter,input:!0}],width:1,offset:0,push:0,pull:0,size:"md",currentWidth:1},{components:[{label:"Clear",action:"event",showValidations:!1,theme:"secondary",key:o.reportingControlsConfig.events.clearFilters,type:"button",event:o.reportingControlsConfig.events.clearFilters,input:!0}],width:1,offset:0,push:0,pull:0,size:"md",currentWidth:1},{components:[],size:"md",width:10,offset:0,push:0,pull:0,currentWidth:10}],key:"columns",type:"columns",input:!1}]}},o.getActionsTab=function(d){return{label:'<i class="fa fa-download mr-1" aria-hidden="true"></i>Actions',key:"actionsControls",components:[{label:"Action",widget:"choicesjs",data:{values:a._.map(d||[],(C,A)=>({label:C.title,value:""+A}))},dataType:"number",key:o.reportingControlsConfig.actionCompKey,type:"select",hideLabel:!0,placeholder:"Action",description:"Select the action you want to apply. The action can be performed only when 1 or more rows are selected in the Reporting Grid.",input:!0},{label:"Perform Action",action:"event",key:o.reportingControlsConfig.events.performAction,type:"button",event:o.reportingControlsConfig.events.performAction,input:!0,disabled:!0,logic:[{name:"enable on valid filters",trigger:{type:"javascript",javascript:`
                  var controls = instance.root.getComponent('`+o.reportingControlsConfig.controlsKey+`');
                  result = !!controls.reportingGrid.selectedRows?.length && _.isNumber(data.action) && !controls.performingAction;
                `},actions:[{name:"enable",type:"property",property:{label:"Disabled",value:"disabled",type:"boolean"},state:!1}]},{name:"Change label on action execution",trigger:{type:"javascript",javascript:`
                  var controls = instance.root.getComponent('`+o.reportingControlsConfig.controlsKey+`');
                  result = controls.performingAction;
                `},actions:[{name:"change label",type:"property",property:{label:"Label",value:"label",type:"string"},text:'Performing Action  <i class="fa fa-spinner fa-pulse fa-lg fa-fw"></i> <span class="sr-only">Loading...</span>'}]},{name:"check data on row selection",trigger:{type:"event",event:"rowSelectChange"},actions:[{name:"check data",type:"customAction",customAction:`
                  if(_.isNumber(data.action)){
                    instance.checkData();
                  }`}]}]}]}},o.getControlsTabsComponet=function({title:d="Controls",collapsePanel:C=!1,theme:A="default",tabs:p=[]}){return{title:d,collapsible:!0,key:"controlsTabs",type:"panel",label:"Panel",collapsed:C,theme:A,components:[{label:"Tabs",components:p,key:"tabs",type:"tabs",input:!1}]}},o.convertToCSV=function({submissions:d,components:C,fileName:A}){let p=["Submission ID"],y=[];a._.each(C,(T,g)=>{let b=T.label||T.key;p.push(b?'"'+b+'"':"");let _=l.Formio.Components.components[T.type],H=_?new _(T):null;a._.each(d,(I,O)=>{if(!g){let j=I._id;y.push([m(j)])}let R=a._.get(I,T.key,""),S=H?H.getView(R,{csv:!0}):R;y[O].push(S?'"'+S+'"':"")}),y.push([])});let E=a._.map([p,...y],T=>Object.values(T).toString()).join(`
`);(0,s.saveAs)(new Blob([w(E)],{type:"text/csv;charset=utf-8"}),A+".csv")};let x=u(704),l=u(328),a=u(552),v=u(132),s=u(480);function i(d,C=1){let A=a._.chunk(d,C),p=12/C,y=[];return a._.each(A,(E,T)=>{let g=[];for(let b=0;b<C;b++)g.push({components:E[b]?[E[b]]:[],width:p,offset:0,push:0,pull:0,size:"md",currentWidth:p});y.push({label:"Columns",columns:g,key:"filtersRow"+T,type:"columns",input:!1})}),y}function w(d){if(!d)return d;a._.isString(d)||(d=d.toString());let C='(?<=(?:^|"|\u201C)\\s*)(['+["=","+","-","@"].join("\\")+"])",A=new RegExp(C,"gm");return a._.replace(d,A,p=>"`"+p)}function m(d){let C=d;return C?(a._.isPlainObject(C)&&(C="{"+a._.map(d,(A,p)=>p+": "+A).join(", ")+"}"),'"'+C+'"'):""}o.reportingControlsConfig={controlsKey:"reportingControls",filtersCompKey:"filters",actionCompKey:"action",displayedColumnsCompKey:"displayedColumns",events:{applyColumns:"applyColumns",filter:"filter",clearFilters:"clearFilters",performAction:"performAction"},filterSetClass:"filter-set"},o.getPDFDownloadUrl=d=>P(void 0,[d],void 0,function*({projectId:C,submissions:A,form:p}){let y=yield l.Formio.fetch(l.Formio.getApiUrl()+"/pdf-proxy/pdf/"+C+"/download",{method:"POST",headers:{"Content-Type":"application/json","x-jwt-token":l.Formio.getToken()},body:JSON.stringify({form:p,submission:A})}),E=yield y.blob();return URL.createObjectURL(E)})},988:function(U,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default={equal:"equal",notEqual:"notEqual",startsWith:"startsWith",contain:"contain",notContain:"notContain",endsWith:"endsWith",matches:"matches",greaterThen:"gt",greaterThenOrEqual:"gte",lessThen:"lt",lessThenOrEqual:"lte",exist:"exist",empty:"empty",notEmpty:"notEmpty",notExist:"notExist",sort:"sort",limit:"limit",skip:"skip"}},704:function(U,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.reportingGridConfig=void 0,o.reportingGridConfig={gridKey:"reportingGrid"}},288:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0});let P=u(552),x=u(704),l=u(296),a=u(132),v=u(988),s=Object.assign(Object.assign(Object.assign(Object.assign({},P),x),l),{FilterOperators:a.default,filtersQueries:v.default});o.default=s},0:function(U,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default="reporting"},552:function(U,o,u){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.defaultColumns=o.connectionByFullSubmissionObjectOptionValue=o.valueTypes=o._=void 0,o.convertReportingFormCompIntoGridComp=function(s,i){let{displayTitle:w}=i,m=o._.omit(s,["logic","prefix","suffix","action","defaultValue","conditional","hideLabel","calculateValue","validate","hidden","customConditional"]);return w&&(m.label=w),m.key=a(i),m},o.getCalcOperatorFieldArgs=function(s){let{operator:i}=s,w=x.default[i];return w?w.getFieldArgs(s):[]},o.convertReportingCalcSettingsIntoGridComp=function(s,i){let{key:w,name:m,operator:d}=s,C=x.default[d];return Object.assign({key:a({path:w}),label:m},C?C.getDisplayField(s,i):{})},o.getPropertyFromFormId=l,o.getDataPath=a,o.getJoinedFormDataPathInJoinedObj=function(s){return"data."+l(s)},o.getAggrOperatorNumberField=function(s,i){let w={type:"number"},{calculatedColumnsSettings:m={}}=i||{},{decimalLimit:d}=s||{};return o._.isInteger(d)&&o._.assign(w,{requireDecimal:d>0,decimalLimit:d,delimiter:!!m.thousandsSeparator}),w};let P=u(328),x=u(160);function l(s){return"form"+s}function a(s){let{formId:i=null,path:w="",default:m=!1}=s;return i&&m?"data."+l(i)+"."+w:i&&!m?"data."+l(i)+".data."+w:"data."+w}function v(s){return s=s||{},Object.assign({label:"Date/Time",key:"dateTime",type:"datetime",input:!0,widget:{type:"calendar",displayInTimezone:"viewer",useLocaleSettings:!1,allowInput:!0,mode:"single",enableTime:!0,noCalendar:!1,format:"yyyy-MM-dd hh:mm a",hourIncrement:1,minuteIncrement:1,time_24hr:!1}},s)}o._=P.Utils._,o.valueTypes=P.Utils.componentValueTypes,o.connectionByFullSubmissionObjectOptionValue="submissionObject*",o.defaultColumns=[{path:"created",component:v({label:"Created",key:"created"}),submissionRootPath:!0},{path:"modified",component:v({label:"Modified",key:"modified"}),submissionRootPath:!0}]},192:function(U,o,u){"use strict";var P=this&&this.__awaiter||function(v,s,i,w){return new(i||(i=Promise))(function(m,d){function C(y){try{p(w.next(y))}catch(E){d(E)}}function A(y){try{p(w.throw(y))}catch(E){d(E)}}function p(y){var E;y.done?m(y.value):(E=y.value,E instanceof i?E:new i(function(T){T(E)})).then(C,A)}p((w=w.apply(v,s||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0}),o.OfflineLibraryLicense=void 0;let x=u(40),l=u(472);class a extends Error{constructor(s,i){super(s?a.errorMessagePrefix+`
`+s:a.errorMessagePrefix+`
Unexpected error occurred.`),this.softFailLicenseExpiration=!1,this.softFailLicenseExpiration=i}}a.errorMessagePrefix="Library License check error:",o.OfflineLibraryLicense=class{constructor(v,s){this.libraryName=v,this.injectedPublicKey=s,this.publicKey=`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA18xeGY0UiaVCjhkJeb68
IHs/MkytZSeZwL75gySrVnVF6VI36CrEZe1hSZwXgufGVSLm2+Ec3KXeLLNtGFYP
Hzx66kPl6jRc1/7RnZdEQYeANDNg/BhlG+54Eu4dczp17agImfehsAyEIctvlL63
yRAGqnoBWt1Khxfa5ocqtbZaep+3PI9yTgbyiYw/9rBYI5U8NiTPti9xt/jw/phe
borJ64CeCQB/ipCFYgRj+WlnskDkL1/0TMi+4Hsu4eZSTZP7Mx6+qmjAGF9ahQmL
IR7SEwFmVZK8aBe4knBKkL9IjOFl60Pjx4LoLvbpjIKCoM91pz2lMOoMHJIxhhwp
kQIDAQAB
-----END PUBLIC KEY-----
`}checkTerms(){var v,s;if(this.libraryName&&!(!((s=(v=this.parsedLicenseKey)===null||v===void 0?void 0:v.terms)===null||s===void 0)&&s[this.libraryName]))throw new a((0,l.capitalize)(this.libraryName)+" is disabled in your license.")}checkExpiration(){let{exp:v,failDate:s}=this.parsedLicenseKey;if(!v)return;let i=!1,w=Math.floor(Date.now()/1e3);switch(typeof v){case"string":i=(0,l.dateStringToMilliseconds)(v)<w;break;case"number":case"object":i=v<w;break;default:throw new a("Invalid expiration date provided.")}if(s=function(m){return m>1e12?Math.floor(m/1e3):m}(s),i)throw w<s?new a("Your Library License has expired. Please contact sales@form.io to renew it",!0):new a("License is expired")}checkAllowedHostnames(){var v;let{hostnames:s}=(v=this.parsedLicenseKey)===null||v===void 0?void 0:v.terms,i=window.location.protocol+"//"+window.location.hostname;if(!(0,l.isAllowedUrl)(s,i))throw new a("Current hostname ("+i+") is not allowed.")}checkAllowedEndpoints(v,s){return P(this,void 0,void 0,function*(){var i;if(!this.parsedLicenseKey){if(!s)throw new a("License Key should be provided to verify allowed endpoints.");this.parsedLicenseKey=yield this.parseKey(s)}let{endpoints:w}=(i=this.parsedLicenseKey)===null||i===void 0?void 0:i.terms;if(window.Formio){let m=window.Formio.getProjectUrl(),d=window.Formio.getBaseUrl();if(!(0,l.isAllowedUrl)(w,m)&&!(0,l.isAllowedUrl)(w,d))throw new a("Formio.projectUrl and Formio.baseUrl are not allowed for this license.")}})}parseKey(v){return P(this,void 0,void 0,function*(){try{let{payload:s}=yield(0,x.compactVerify)(v,yield(0,x.importSPKI)(this.injectedPublicKey||this.publicKey,"PS256"));return JSON.parse(new TextDecoder("utf-8").decode(s))}catch(s){throw console.error("Error parsing Library License key: "+s.message),new a("Invalid key provided.")}})}verify(v){return P(this,arguments,void 0,function*(s,i=!0){if(!s)throw new a("License key not provided.");try{this.parsedLicenseKey=yield this.parseKey(s),this.checkTerms(),this.checkExpiration(),i&&this.checkAllowedHostnames()}catch(w){throw w instanceof a?w:(console.error("Unexpected Library License verify error: "+w.message),new a)}})}generate(v,s){return P(this,void 0,void 0,function*(){let i=yield(0,x.importPKCS8)(s,"PS256");return yield new x.CompactSign(new TextEncoder().encode(JSON.stringify(v))).setProtectedHeader({alg:"PS256"}).sign(i)})}}},472:function(U,o){"use strict";function u(x){return!Number.isNaN(Date.parse(x))}function P(x){return(x=x.replace(/\*\./,"(\\S+\\.)?").replace(/([A-Za-z0-9])\.([A-Za-z0-9])/g,"$1\\.$2")).match(/^\(?http/)||(x="(http[s]?://)?"+x),x}Object.defineProperty(o,"__esModule",{value:!0}),o.isValidDate=u,o.dateStringToMilliseconds=function(x){if(!u(x))throw new Error("Provided invalid date string.");return new Date(x).getTime()},o.normalizeUrl=P,o.capitalize=function(x){return typeof x!="string"?"":""+x.charAt(0).toUpperCase()+x.slice(1).toLowerCase()},o.isAllowedUrl=function(x=[],l){return["(http[s]?://)?(\\S+\\.)?localhost(:[0-9]+)?","(http[s]?://)?(\\S+\\.)?lvh.me(:[0-9]+)?","(http[s]?://)?(\\S+\\.)?\\S+\\.local(:[0-9]+)?"].concat(x=x||[]).some(a=>new RegExp("^"+P(a),"i").test(l))}},480:function(U,o,u){var P,x;(x=typeof(P=function(){"use strict";function l(m,d,C){var A=new XMLHttpRequest;A.open("GET",m),A.responseType="blob",A.onload=function(){w(A.response,d,C)},A.onerror=function(){console.error("could not download file")},A.send()}function a(m){var d=new XMLHttpRequest;d.open("HEAD",m,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function v(m){try{m.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),m.dispatchEvent(d)}}var s=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof u.g=="object"&&u.g.global===u.g?u.g:void 0,i=s.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=s.saveAs||(typeof window!="object"||window!==s?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(m,d,C){var A=s.URL||s.webkitURL,p=document.createElement("a");d=d||m.name||"download",p.download=d,p.rel="noopener",typeof m=="string"?(p.href=m,p.origin===location.origin?v(p):a(p.href)?l(m,d,C):v(p,p.target="_blank")):(p.href=A.createObjectURL(m),setTimeout(function(){A.revokeObjectURL(p.href)},4e4),setTimeout(function(){v(p)},0))}:"msSaveOrOpenBlob"in navigator?function(m,d,C){if(d=d||m.name||"download",typeof m!="string")navigator.msSaveOrOpenBlob(function(p,y){return y===void 0?y={autoBom:!1}:typeof y!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),y={autoBom:!y}),y.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(p.type)?new Blob(["\uFEFF",p],{type:p.type}):p}(m,C),d);else if(a(m))l(m,d,C);else{var A=document.createElement("a");A.href=m,A.target="_blank",setTimeout(function(){v(A)})}}:function(m,d,C,A){if((A=A||open("","_blank"))&&(A.document.title=A.document.body.innerText="downloading..."),typeof m=="string")return l(m,d,C);var p=m.type==="application/octet-stream",y=/constructor/i.test(s.HTMLElement)||s.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||p&&y||i)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var _=T.result;_=E?_:_.replace(/^data:[^;]*;/,"data:attachment/file;"),A?A.location.href=_:location=_,A=null},T.readAsDataURL(m)}else{var g=s.URL||s.webkitURL,b=g.createObjectURL(m);A?A.location=b:location.href=b,A=null,setTimeout(function(){g.revokeObjectURL(b)},4e4)}});s.saveAs=w.saveAs=w,U.exports=w})=="function"?P.apply(o,[]):P)===void 0||(U.exports=x)},328:function(U){"use strict";U.exports=Formio},40:function(U,o,u){"use strict";u.r(o),u.d(o,{CompactEncrypt:function(){return xr},CompactSign:function(){return lr},EmbeddedJWK:function(){return ln},EncryptJWT:function(){return cn},FlattenedEncrypt:function(){return Ye},FlattenedSign:function(){return ft},GeneralEncrypt:function(){return Qr},GeneralSign:function(){return an},SignJWT:function(){return sn},UnsecuredJWT:function(){return gn},base64url:function(){return x},calculateJwkThumbprint:function(){return ur},calculateJwkThumbprintUri:function(){return xn},compactDecrypt:function(){return tr},compactVerify:function(){return sr},createLocalJWKSet:function(){return mt},createRemoteJWKSet:function(){return hn},cryptoRuntime:function(){return An},decodeJwt:function(){return wn},decodeProtectedHeader:function(){return yn},errors:function(){return P},experimental_jwksCache:function(){return fn},exportJWK:function(){return nr},exportPKCS8:function(){return Yr},exportSPKI:function(){return zr},flattenedDecrypt:function(){return dt},flattenedVerify:function(){return pt},generalDecrypt:function(){return $r},generalVerify:function(){return en},generateKeyPair:function(){return bn},generateSecret:function(){return vn},importJWK:function(){return je},importPKCS8:function(){return Br},importSPKI:function(){return Lr},importX509:function(){return Nr},jwksCache:function(){return Ue},jwtDecrypt:function(){return nn},jwtVerify:function(){return rn}});var P={};u.r(P),u.d(P,{JOSEAlgNotAllowed:function(){return I},JOSEError:function(){return b},JOSENotSupported:function(){return O},JWEDecryptionFailed:function(){return R},JWEInvalid:function(){return S},JWKInvalid:function(){return V},JWKSInvalid:function(){return N},JWKSMultipleMatchingKeys:function(){return ne},JWKSNoMatchingKey:function(){return ie},JWKSTimeout:function(){return de},JWSInvalid:function(){return j},JWSSignatureVerificationFailed:function(){return me},JWTClaimValidationFailed:function(){return _},JWTExpired:function(){return H},JWTInvalid:function(){return M}});var x={};u.r(x),u.d(x,{decode:function(){return wt},encode:function(){return mn}});var l=crypto;let a=e=>e instanceof CryptoKey;var v=(e,t)=>W(this,null,function*(){let r="SHA-"+e.slice(-3);return new Uint8Array(yield l.subtle.digest(r,t))});let s=new TextEncoder,i=new TextDecoder,w=2**32;function m(...e){let t=e.reduce((f,{length:c})=>f+c,0),r=new Uint8Array(t),n=0;for(let f of e)r.set(f,n),n+=f.length;return r}function d(e,t,r){if(t<0||t>=w)throw new RangeError("value must be >= 0 and <= "+(w-1)+". Received "+t);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function C(e){let t=Math.floor(e/w),r=e%w,n=new Uint8Array(8);return d(n,t,0),d(n,r,4),n}function A(e){let t=new Uint8Array(4);return d(t,e),t}function p(e){return m(A(e.length),e)}let y=e=>{let t=e;typeof t=="string"&&(t=s.encode(t));let r=[];for(let n=0;n<t.length;n+=32768)r.push(String.fromCharCode.apply(null,t.subarray(n,n+32768)));return btoa(r.join(""))},E=e=>y(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),T=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r},g=e=>{let t=e;t instanceof Uint8Array&&(t=i.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return T(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class b extends Error{constructor(t,r){super(t,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}b.code="ERR_JOSE_GENERIC";class _ extends b{constructor(t,r,n="unspecified",f="unspecified"){super(t,{cause:{claim:n,reason:f,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=n,this.reason=f,this.payload=r}}_.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class H extends b{constructor(t,r,n="unspecified",f="unspecified"){super(t,{cause:{claim:n,reason:f,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=n,this.reason=f,this.payload=r}}H.code="ERR_JWT_EXPIRED";class I extends b{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}I.code="ERR_JOSE_ALG_NOT_ALLOWED";class O extends b{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}O.code="ERR_JOSE_NOT_SUPPORTED";class R extends b{constructor(t="decryption operation failed",r){super(t,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}R.code="ERR_JWE_DECRYPTION_FAILED";class S extends b{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}S.code="ERR_JWE_INVALID";class j extends b{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}j.code="ERR_JWS_INVALID";class M extends b{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}M.code="ERR_JWT_INVALID";class V extends b{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}V.code="ERR_JWK_INVALID";class N extends b{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}N.code="ERR_JWKS_INVALID";class ie extends b{constructor(t="no applicable key found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}ie.code="ERR_JWKS_NO_MATCHING_KEY";class ne extends b{constructor(t="multiple matching keys found in the JSON Web Key Set",r){super(t,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}ne.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class de extends b{constructor(t="request timed out",r){super(t,r),this.code="ERR_JWKS_TIMEOUT"}}de.code="ERR_JWKS_TIMEOUT";class me extends b{constructor(t="signature verification failed",r){super(t,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}me.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";var he=l.getRandomValues.bind(l);function Ne(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new O("Unsupported JWE Algorithm: "+e)}}var ye=(e,t)=>{if(t.length<<3!==Ne(e))throw new S("Invalid Initialization Vector length")},we=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new S("Invalid Content Encryption Key length. Expected "+t+" bits, got "+r+" bits")};function oe(e,t="algorithm.name"){return new TypeError("CryptoKey does not support this operation, its "+t+" must be "+e)}function be(e,t){return e.name===t}function Be(e){return parseInt(e.name.slice(4),10)}function Tt(e,t){if(t.length&&!t.some(r=>e.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let n=t.pop();r+="one of "+t.join(", ")+", or "+n+"."}else t.length===2?r+="one of "+t[0]+" or "+t[1]+".":r+=t[0]+".";throw new TypeError(r)}}function ve(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!be(e.algorithm,"AES-GCM"))throw oe("AES-GCM");let n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw oe(n,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!be(e.algorithm,"AES-KW"))throw oe("AES-KW");let n=parseInt(t.slice(1,4),10);if(e.algorithm.length!==n)throw oe(n,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw oe("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!be(e.algorithm,"PBKDF2"))throw oe("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!be(e.algorithm,"RSA-OAEP"))throw oe("RSA-OAEP");let n=parseInt(t.slice(9),10)||1;if(Be(e.algorithm.hash)!==n)throw oe("SHA-"+n,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}Tt(e,r)}function Rt(e,t,...r){if((r=r.filter(Boolean)).length>2){let n=r.pop();e+="one of type "+r.join(", ")+", or "+n+"."}else r.length===2?e+="one of type "+r[0]+" or "+r[1]+".":e+="of type "+r[0]+".";return t==null?e+=" Received "+t:typeof t=="function"&&t.name?e+=" Received function "+t.name:typeof t=="object"&&t!=null&&t.constructor?.name&&(e+=" Received an instance of "+t.constructor.name),e}var se=(e,...t)=>Rt("Key must be ",e,...t);function Ht(e,t,...r){return Rt("Key for the "+e+" algorithm must be ",t,...r)}var Kt=e=>!!a(e)||e?.[Symbol.toStringTag]==="KeyObject";let ce=["CryptoKey"];var Dt=(e,t,r,n,f,c)=>W(this,null,function*(){if(!(a(t)||t instanceof Uint8Array))throw new TypeError(se(t,...ce,"Uint8Array"));if(!n)throw new S("JWE Initialization Vector missing");if(!f)throw new S("JWE Authentication Tag missing");switch(ye(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&we(t,parseInt(e.slice(-3),10)),function(h,k,F,D,K,L){return W(this,null,function*(){if(!(k instanceof Uint8Array))throw new TypeError(se(k,"Uint8Array"));let B=parseInt(h.slice(1,4),10),z=yield l.subtle.importKey("raw",k.subarray(B>>3),"AES-CBC",!1,["decrypt"]),$=yield l.subtle.importKey("raw",k.subarray(0,B>>3),{hash:"SHA-"+(B<<1),name:"HMAC"},!1,["sign"]),q=m(L,D,F,C(L.length<<3)),Q=new Uint8Array((yield l.subtle.sign("HMAC",$,q)).slice(0,B>>3)),Z,re;try{Z=((fe,le)=>{if(!(fe instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(le instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(fe.length!==le.length)throw new TypeError("Input buffers must have the same length");let Xe=fe.length,Qe=0,ke=-1;for(;++ke<Xe;)Qe|=fe[ke]^le[ke];return Qe===0})(K,Q)}catch{}if(!Z)throw new R;try{re=new Uint8Array(yield l.subtle.decrypt({iv:D,name:"AES-CBC"},z,F))}catch{}if(!re)throw new R;return re})}(e,t,r,n,f,c);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&we(t,parseInt(e.slice(1,4),10)),function(h,k,F,D,K,L){return W(this,null,function*(){let B;k instanceof Uint8Array?B=yield l.subtle.importKey("raw",k,"AES-GCM",!1,["decrypt"]):(ve(k,h,"decrypt"),B=k);try{return new Uint8Array(yield l.subtle.decrypt({additionalData:L,iv:D,name:"AES-GCM",tagLength:128},B,m(F,K)))}catch{throw new R}})}(e,t,r,n,f,c);default:throw new O("Unsupported JWE Content Encryption Algorithm")}}),Fe=(...e)=>{let t=e.filter(Boolean);if(t.length===0||t.length===1)return!0;let r;for(let n of t){let f=Object.keys(n);if(r&&r.size!==0)for(let c of f){if(r.has(c))return!1;r.add(c)}else r=new Set(f)}return!0};function te(e){if(typeof(t=e)!="object"||t===null||Object.prototype.toString.call(e)!=="[object Object]")return!1;var t;if(Object.getPrototypeOf(e)===null)return!0;let r=e;for(;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}var Ve=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function Ft(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw new TypeError("Invalid key size for alg: "+t)}function jt(e,t,r){if(a(e))return ve(e,t,r),e;if(e instanceof Uint8Array)return l.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw new TypeError(se(e,...ce,"Uint8Array"))}let at=(e,t,r)=>W(this,null,function*(){let n=yield jt(t,e,"wrapKey");Ft(n,e);let f=yield l.subtle.importKey("raw",r,...Ve);return new Uint8Array(yield l.subtle.wrapKey("raw",f,n,"AES-KW"))}),st=(e,t,r)=>W(this,null,function*(){let n=yield jt(t,e,"unwrapKey");Ft(n,e);let f=yield l.subtle.unwrapKey("raw",r,n,"AES-KW",...Ve);return new Uint8Array(yield l.subtle.exportKey("raw",f))});function It(h,k,F,D){return W(this,arguments,function*(e,t,r,n,f=new Uint8Array(0),c=new Uint8Array(0)){if(!a(e))throw new TypeError(se(e,...ce));if(ve(e,"ECDH"),!a(t))throw new TypeError(se(t,...ce));ve(t,"ECDH","deriveBits");let K=m(p(s.encode(r)),p(f),p(c),A(n)),L;return L=e.algorithm.name==="X25519"?256:e.algorithm.name==="X448"?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,function(B,z,$){return W(this,null,function*(){let q=Math.ceil((z>>3)/32),Q=new Uint8Array(32*q);for(let Z=0;Z<q;Z++){let re=new Uint8Array(4+B.length+$.length);re.set(A(Z+1)),re.set(B,4),re.set($,4+B.length),Q.set(yield v("sha256",re),32*Z)}return Q.slice(0,z>>3)})}(new Uint8Array(yield l.subtle.deriveBits({name:e.algorithm.name,public:e},t,L)),n,K)})}function Wt(e){if(!a(e))throw new TypeError(se(e,...ce));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||e.algorithm.name==="X25519"||e.algorithm.name==="X448"}function Ut(e,t,r,n){return W(this,null,function*(){(function(D){if(!(D instanceof Uint8Array)||D.length<8)throw new S("PBES2 Salt Input must be 8 or more octets")})(e);let f=function(D,K){return m(s.encode(D),new Uint8Array([0]),K)}(t,e),c=parseInt(t.slice(13,16),10),h={hash:"SHA-"+t.slice(8,11),iterations:r,name:"PBKDF2",salt:f},k={length:c,name:"AES-KW"},F=yield function(D,K){if(D instanceof Uint8Array)return l.subtle.importKey("raw",D,"PBKDF2",!1,["deriveBits"]);if(a(D))return ve(D,K,"deriveBits","deriveKey"),D;throw new TypeError(se(D,...ce,"Uint8Array"))}(n,t);if(F.usages.includes("deriveBits"))return new Uint8Array(yield l.subtle.deriveBits(h,F,c));if(F.usages.includes("deriveKey"))return l.subtle.deriveKey(h,F,k,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')})}function $e(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new O("alg "+e+" is not supported either by JOSE or your javascript runtime")}}var qe=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(e+" requires key modulusLength to be 2048 bits or larger")}};function Te(e){return te(e)&&typeof e.kty=="string"}var Jt=e=>W(this,null,function*(){if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(c){let h,k;switch(c.kty){case"RSA":switch(c.alg){case"PS256":case"PS384":case"PS512":h={name:"RSA-PSS",hash:"SHA-"+c.alg.slice(-3)},k=c.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":h={name:"RSASSA-PKCS1-v1_5",hash:"SHA-"+c.alg.slice(-3)},k=c.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h={name:"RSA-OAEP",hash:"SHA-"+(parseInt(c.alg.slice(-3),10)||1)},k=c.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(c.alg){case"ES256":h={name:"ECDSA",namedCurve:"P-256"},k=c.d?["sign"]:["verify"];break;case"ES384":h={name:"ECDSA",namedCurve:"P-384"},k=c.d?["sign"]:["verify"];break;case"ES512":h={name:"ECDSA",namedCurve:"P-521"},k=c.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":h={name:"ECDH",namedCurve:c.crv},k=c.d?["deriveBits"]:[];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(c.alg){case"EdDSA":h={name:c.crv},k=c.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":h={name:c.crv},k=c.d?["deriveBits"]:[];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new O('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:h,keyUsages:k}}(e),n=[t,e.ext??!1,e.key_ops??r],f=J({},e);return delete f.alg,delete f.use,l.subtle.importKey("jwk",f,...n)});let Mt=e=>g(e),Re,He,Gt=e=>e?.[Symbol.toStringTag]==="KeyObject",ze=(e,t,r,n,f=!1)=>W(this,null,function*(){let c=e.get(t);if(c?.[n])return c[n];let h=yield Jt(Y(J({},r),{alg:n}));return f&&Object.freeze(t),c?c[n]=h:e.set(t,{[n]:h}),h});var Lt=(e,t)=>{if(Gt(e)){let r=e.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?Mt(r.k):(He||(He=new WeakMap),ze(He,e,r,t))}return Te(e)?e.k?g(e.k):(He||(He=new WeakMap),ze(He,e,e,t,!0)):e},Nt=(e,t)=>{if(Gt(e)){let r=e.export({format:"jwk"});return r.k?Mt(r.k):(Re||(Re=new WeakMap),ze(Re,e,r,t))}return Te(e)?e.k?g(e.k):(Re||(Re=new WeakMap),ze(Re,e,e,t,!0)):e};function ct(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new O("Unsupported JWE Algorithm: "+e)}}var _e=e=>he(new Uint8Array(ct(e)>>3)),Bt=(e,t)=>"-----BEGIN "+t+`-----
`+(e.match(/.{1,64}/g)||[]).join(`
`)+`
-----END `+t+"-----";let Vt=(e,t,r)=>W(this,null,function*(){if(!a(r))throw new TypeError(se(r,...ce));if(!r.extractable)throw new TypeError("CryptoKey is not extractable");if(r.type!==e)throw new TypeError("key is not a "+e+" key");return Bt(y(new Uint8Array(yield l.subtle.exportKey(t,r))),e.toUpperCase()+" KEY")}),Ur=e=>Vt("public","spki",e),Jr=e=>Vt("private","pkcs8",e),Ae=(e,t,r=0)=>{r===0&&(t.unshift(t.length),t.unshift(6));let n=e.indexOf(t[0],r);if(n===-1)return!1;let f=e.subarray(n,n+t.length);return f.length===t.length&&(f.every((c,h)=>c===t[h])||Ae(e,t,n+1))},$t=e=>{switch(!0){case Ae(e,[42,134,72,206,61,3,1,7]):return"P-256";case Ae(e,[43,129,4,0,34]):return"P-384";case Ae(e,[43,129,4,0,35]):return"P-521";case Ae(e,[43,101,110]):return"X25519";case Ae(e,[43,101,111]):return"X448";case Ae(e,[43,101,112]):return"Ed25519";case Ae(e,[43,101,113]):return"Ed448";default:throw new O("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},qt=(e,t,r,n,f)=>W(this,null,function*(){let c,h,k=new Uint8Array(atob(r.replace(e,"")).split("").map(D=>D.charCodeAt(0))),F=t==="spki";switch(n){case"PS256":case"PS384":case"PS512":c={name:"RSA-PSS",hash:"SHA-"+n.slice(-3)},h=F?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":c={name:"RSASSA-PKCS1-v1_5",hash:"SHA-"+n.slice(-3)},h=F?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":c={name:"RSA-OAEP",hash:"SHA-"+(parseInt(n.slice(-3),10)||1)},h=F?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":c={name:"ECDSA",namedCurve:"P-256"},h=F?["verify"]:["sign"];break;case"ES384":c={name:"ECDSA",namedCurve:"P-384"},h=F?["verify"]:["sign"];break;case"ES512":c={name:"ECDSA",namedCurve:"P-521"},h=F?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let D=$t(k);c=D.startsWith("P-")?{name:"ECDH",namedCurve:D}:{name:D},h=F?[]:["deriveBits"];break}case"EdDSA":c={name:$t(k)},h=F?["verify"]:["sign"];break;default:throw new O('Invalid or unsupported "alg" (Algorithm) value')}return l.subtle.importKey(t,k,c,f?.extractable??!1,h)}),Mr=(e,t,r)=>qt(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r),zt=(e,t,r)=>qt(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r);function Yt(e){let t=[],r=0;for(;r<e.length;){let n=Xt(e.subarray(r));t.push(n),r+=n.byteLength}return t}function Xt(e){let t=0,r=31&e[0];if(t++,r===31){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let n=0;if(e[t]<128)n=e[t],t++;else{if(n===128){for(n=0;e[t+n]!==0||e[t+n+1]!==0;){if(n>e.byteLength)throw new TypeError("invalid indefinite form length");n++}let c=t+n+2;return{byteLength:c,contents:e.subarray(t,t+n),raw:e.subarray(0,c)}}{let c=127&e[t];t++,n=0;for(let h=0;h<c;h++)n=256*n+e[t],t++}}let f=t+n;return{byteLength:f,contents:e.subarray(t,f),raw:e.subarray(0,f)}}let Gr=(e,t,r)=>{let n;try{n=function(f){let c=f.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),h=T(c);return Bt(function(k){let F=Yt(Yt(Xt(k).contents)[0].contents);return y(F[F[0].raw[0]===160?6:5].raw)}(h),"PUBLIC KEY")}(e)}catch(f){throw new TypeError("Failed to parse the X.509 certificate",{cause:f})}return zt(n,t,r)};function Lr(e,t,r){return W(this,null,function*(){if(typeof e!="string"||e.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return zt(e,t,r)})}function Nr(e,t,r){return W(this,null,function*(){if(typeof e!="string"||e.indexOf("-----BEGIN CERTIFICATE-----")!==0)throw new TypeError('"x509" must be X.509 formatted string');return Gr(e,t,r)})}function Br(e,t,r){return W(this,null,function*(){if(typeof e!="string"||e.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return Mr(e,t,r)})}function je(e,t){return W(this,null,function*(){if(!te(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if(typeof e.k!="string"||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return g(e.k);case"RSA":if(e.oth!==void 0)throw new O('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return Jt(Y(J({},e),{alg:t}));default:throw new O('Unsupported "kty" (Key Type) Parameter value')}})}let Ke=e=>e?.[Symbol.toStringTag],xt=(e,t,r)=>{if(t.use!==void 0&&t.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(t.key_ops!==void 0&&t.key_ops.includes?.(r)!==!0)throw new TypeError("Invalid key for this operation, when present its key_ops must include "+r);if(t.alg!==void 0&&t.alg!==e)throw new TypeError("Invalid key for this operation, when present its alg must be "+e);return!0};function Qt(e,t,r,n){t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?((f,c,h,k)=>{if(!(c instanceof Uint8Array)){if(k&&Te(c)){if(function(F){return Te(F)&&F.kty==="oct"&&typeof F.k=="string"}(c)&&xt(f,c,h))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Kt(c))throw new TypeError(Ht(f,c,...ce,"Uint8Array",k?"JSON Web Key":null));if(c.type!=="secret")throw new TypeError(Ke(c)+' instances for symmetric algorithms must be of type "secret"')}})(t,r,n,e):((f,c,h,k)=>{if(k&&Te(c))switch(h){case"sign":if(function(F){return F.kty!=="oct"&&typeof F.d=="string"}(c)&&xt(f,c,h))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(F){return F.kty!=="oct"&&F.d===void 0}(c)&&xt(f,c,h))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Kt(c))throw new TypeError(Ht(f,c,...ce,k?"JSON Web Key":null));if(c.type==="secret")throw new TypeError(Ke(c)+' instances for asymmetric algorithms must not be of type "secret"');if(h==="sign"&&c.type==="public")throw new TypeError(Ke(c)+' instances for asymmetric algorithm signing must be of type "private"');if(h==="decrypt"&&c.type==="public")throw new TypeError(Ke(c)+' instances for asymmetric algorithm decryption must be of type "private"');if(c.algorithm&&h==="verify"&&c.type==="private")throw new TypeError(Ke(c)+' instances for asymmetric algorithm verifying must be of type "public"');if(c.algorithm&&h==="encrypt"&&c.type==="private")throw new TypeError(Ke(c)+' instances for asymmetric algorithm encryption must be of type "public"')})(t,r,n,e)}var Zt=Qt.bind(void 0,!1);let lt=Qt.bind(void 0,!0);var er=(e,t,r,n,f)=>W(this,null,function*(){if(!(a(r)||r instanceof Uint8Array))throw new TypeError(se(r,...ce,"Uint8Array"));switch(n?ye(e,n):n=he(new Uint8Array(Ne(e)>>3)),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&we(r,parseInt(e.slice(-3),10)),function(c,h,k,F,D){return W(this,null,function*(){if(!(k instanceof Uint8Array))throw new TypeError(se(k,"Uint8Array"));let K=parseInt(c.slice(1,4),10),L=yield l.subtle.importKey("raw",k.subarray(K>>3),"AES-CBC",!1,["encrypt"]),B=yield l.subtle.importKey("raw",k.subarray(0,K>>3),{hash:"SHA-"+(K<<1),name:"HMAC"},!1,["sign"]),z=new Uint8Array(yield l.subtle.encrypt({iv:F,name:"AES-CBC"},L,h)),$=m(D,F,z,C(D.length<<3));return{ciphertext:z,tag:new Uint8Array((yield l.subtle.sign("HMAC",B,$)).slice(0,K>>3)),iv:F}})}(e,t,r,n,f);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&we(r,parseInt(e.slice(1,4),10)),function(c,h,k,F,D){return W(this,null,function*(){let K;k instanceof Uint8Array?K=yield l.subtle.importKey("raw",k,"AES-GCM",!1,["encrypt"]):(ve(k,c,"encrypt"),K=k);let L=new Uint8Array(yield l.subtle.encrypt({additionalData:D,iv:F,name:"AES-GCM",tagLength:128},K,h)),B=L.slice(-16);return{ciphertext:L.slice(0,-16),tag:B,iv:F}})}(e,t,r,n,f);default:throw new O("Unsupported JWE Content Encryption Algorithm")}}),Vr=function(e,t,r,n,f){return W(this,null,function*(){switch(Zt(e,t,"decrypt"),t=(yield Nt?.(t,e))||t,e){case"dir":if(r!==void 0)throw new S("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(r!==void 0)throw new S("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!te(n.epk))throw new S('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!Wt(t))throw new O("ECDH with the provided key is not allowed or not supported by your javascript runtime");let c=yield je(n.epk,e),h,k;if(n.apu!==void 0){if(typeof n.apu!="string")throw new S('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{h=g(n.apu)}catch{throw new S("Failed to base64url decode the apu")}}if(n.apv!==void 0){if(typeof n.apv!="string")throw new S('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{k=g(n.apv)}catch{throw new S("Failed to base64url decode the apv")}}let F=yield It(c,t,e==="ECDH-ES"?n.enc:e,e==="ECDH-ES"?ct(n.enc):parseInt(e.slice(-5,-2),10),h,k);if(e==="ECDH-ES")return F;if(r===void 0)throw new S("JWE Encrypted Key missing");return st(e.slice(-6),F,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(r===void 0)throw new S("JWE Encrypted Key missing");return((c,h,k)=>W(this,null,function*(){if(!a(h))throw new TypeError(se(h,...ce));if(ve(h,c,"decrypt","unwrapKey"),qe(c,h),h.usages.includes("decrypt"))return new Uint8Array(yield l.subtle.decrypt($e(c),h,k));if(h.usages.includes("unwrapKey")){let F=yield l.subtle.unwrapKey("raw",k,h,$e(c),...Ve);return new Uint8Array(yield l.subtle.exportKey("raw",F))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')}))(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(r===void 0)throw new S("JWE Encrypted Key missing");if(typeof n.p2c!="number")throw new S('JOSE Header "p2c" (PBES2 Count) missing or invalid');let c=f?.maxPBES2Count||1e4;if(n.p2c>c)throw new S('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if(typeof n.p2s!="string")throw new S('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let h;try{h=g(n.p2s)}catch{throw new S("Failed to base64url decode the p2s")}return((k,F,D,K,L)=>W(this,null,function*(){let B=yield Ut(L,k,K,F);return st(k.slice(-6),B,D)}))(e,t,r,n.p2c,h)}case"A128KW":case"A192KW":case"A256KW":if(r===void 0)throw new S("JWE Encrypted Key missing");return st(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(r===void 0)throw new S("JWE Encrypted Key missing");if(typeof n.iv!="string")throw new S('JOSE Header "iv" (Initialization Vector) missing or invalid');if(typeof n.tag!="string")throw new S('JOSE Header "tag" (Authentication Tag) missing or invalid');let c,h;try{c=g(n.iv)}catch{throw new S("Failed to base64url decode the iv")}try{h=g(n.tag)}catch{throw new S("Failed to base64url decode the tag")}return function(k,F,D,K,L){return W(this,null,function*(){let B=k.slice(0,7);return Dt(B,F,D,K,L,new Uint8Array(0))})}(e,t,r,c,h)}default:throw new O('Invalid or unsupported "alg" (JWE Algorithm) header value')}})},Ie=function(e,t,r,n,f){if(f.crit!==void 0&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(h=>typeof h!="string"||h.length===0))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let c;c=r!==void 0?new Map([...Object.entries(r),...t.entries()]):t;for(let h of n.crit){if(!c.has(h))throw new O('Extension Header Parameter "'+h+'" is not recognized');if(f[h]===void 0)throw new e('Extension Header Parameter "'+h+'" is missing');if(c.get(h)&&n[h]===void 0)throw new e('Extension Header Parameter "'+h+'" MUST be integrity protected')}return new Set(n.crit)},ut=(e,t)=>{if(t!==void 0&&(!Array.isArray(t)||t.some(r=>typeof r!="string")))throw new TypeError('"'+e+'" option must be an array of strings');if(t)return new Set(t)};function dt(e,t,r){return W(this,null,function*(){if(!te(e))throw new S("Flattened JWE must be an object");if(e.protected===void 0&&e.header===void 0&&e.unprotected===void 0)throw new S("JOSE Header missing");if(e.iv!==void 0&&typeof e.iv!="string")throw new S("JWE Initialization Vector incorrect type");if(typeof e.ciphertext!="string")throw new S("JWE Ciphertext missing or incorrect type");if(e.tag!==void 0&&typeof e.tag!="string")throw new S("JWE Authentication Tag incorrect type");if(e.protected!==void 0&&typeof e.protected!="string")throw new S("JWE Protected Header incorrect type");if(e.encrypted_key!==void 0&&typeof e.encrypted_key!="string")throw new S("JWE Encrypted Key incorrect type");if(e.aad!==void 0&&typeof e.aad!="string")throw new S("JWE AAD incorrect type");if(e.header!==void 0&&!te(e.header))throw new S("JWE Shared Unprotected Header incorrect type");if(e.unprotected!==void 0&&!te(e.unprotected))throw new S("JWE Per-Recipient Unprotected Header incorrect type");let n;if(e.protected)try{let re=g(e.protected);n=JSON.parse(i.decode(re))}catch{throw new S("JWE Protected Header is invalid")}if(!Fe(n,e.header,e.unprotected))throw new S("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let f=J(J(J({},n),e.header),e.unprotected);if(Ie(S,new Map,r?.crit,n,f),f.zip!==void 0)throw new O('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:c,enc:h}=f;if(typeof c!="string"||!c)throw new S("missing JWE Algorithm (alg) in JWE Header");if(typeof h!="string"||!h)throw new S("missing JWE Encryption Algorithm (enc) in JWE Header");let k=r&&ut("keyManagementAlgorithms",r.keyManagementAlgorithms),F=r&&ut("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(k&&!k.has(c)||!k&&c.startsWith("PBES2"))throw new I('"alg" (Algorithm) Header Parameter value not allowed');if(F&&!F.has(h))throw new I('"enc" (Encryption Algorithm) Header Parameter value not allowed');let D;if(e.encrypted_key!==void 0)try{D=g(e.encrypted_key)}catch{throw new S("Failed to base64url decode the encrypted_key")}let K,L,B,z=!1;typeof t=="function"&&(t=yield t(n,e),z=!0);try{K=yield Vr(c,t,D,f,r)}catch(re){if(re instanceof TypeError||re instanceof S||re instanceof O)throw re;K=_e(h)}if(e.iv!==void 0)try{L=g(e.iv)}catch{throw new S("Failed to base64url decode the iv")}if(e.tag!==void 0)try{B=g(e.tag)}catch{throw new S("Failed to base64url decode the tag")}let $=s.encode(e.protected??""),q,Q;q=e.aad!==void 0?m($,s.encode("."),s.encode(e.aad)):$;try{Q=g(e.ciphertext)}catch{throw new S("Failed to base64url decode the ciphertext")}let Z={plaintext:yield Dt(h,K,Q,L,B,q)};if(e.protected!==void 0&&(Z.protectedHeader=n),e.aad!==void 0)try{Z.additionalAuthenticatedData=g(e.aad)}catch{throw new S("Failed to base64url decode the aad")}return e.unprotected!==void 0&&(Z.sharedUnprotectedHeader=e.unprotected),e.header!==void 0&&(Z.unprotectedHeader=e.header),z?Y(J({},Z),{key:t}):Z})}function tr(e,t,r){return W(this,null,function*(){if(e instanceof Uint8Array&&(e=i.decode(e)),typeof e!="string")throw new S("Compact JWE must be a string or Uint8Array");let{0:n,1:f,2:c,3:h,4:k,length:F}=e.split(".");if(F!==5)throw new S("Invalid Compact JWE");let D=yield dt({ciphertext:h,iv:c||void 0,protected:n,tag:k||void 0,encrypted_key:f||void 0},t,r),K={plaintext:D.plaintext,protectedHeader:D.protectedHeader};return typeof t=="function"?Y(J({},K),{key:D.key}):K})}function $r(e,t,r){return W(this,null,function*(){if(!te(e))throw new S("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(te))throw new S("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new S("JWE Recipients has no members");for(let n of e.recipients)try{return yield dt({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:n.encrypted_key,header:n.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new R})}let rr=Symbol();var qr=e=>W(this,null,function*(){if(e instanceof Uint8Array)return{kty:"oct",k:E(e)};if(!a(e))throw new TypeError(se(e,...ce,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");let h=yield l.subtle.exportKey("jwk",e),{ext:t,key_ops:r,alg:n,use:f}=h;return Je(h,["ext","key_ops","alg","use"])});function zr(e){return W(this,null,function*(){return Ur(e)})}function Yr(e){return W(this,null,function*(){return Jr(e)})}function nr(e){return W(this,null,function*(){return qr(e)})}var ir=function(c,h,k,F){return W(this,arguments,function*(e,t,r,n,f={}){var B,z;let D,K,L;switch(Zt(e,r,"encrypt"),r=(yield Lt?.(r,e))||r,e){case"dir":L=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!Wt(r))throw new O("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:$,apv:q}=f,{epk:Q}=f;Q||(Q=(yield function(ke){return W(this,null,function*(){if(!a(ke))throw new TypeError(se(ke,...ce));return l.subtle.generateKey(ke.algorithm,!0,["deriveBits"])})}(r)).privateKey);let{x:Z,y:re,crv:fe,kty:le}=yield nr(Q),Xe=yield It(r,Q,e==="ECDH-ES"?t:e,e==="ECDH-ES"?ct(t):parseInt(e.slice(-5,-2),10),$,q);if(K={epk:{x:Z,crv:fe,kty:le}},le==="EC"&&(K.epk.y=re),$&&(K.apu=E($)),q&&(K.apv=E(q)),e==="ECDH-ES"){L=Xe;break}L=n||_e(t);let Qe=e.slice(-6);D=yield at(Qe,Xe,L);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":L=n||_e(t),D=yield(($,q,Q)=>W(this,null,function*(){if(!a(q))throw new TypeError(se(q,...ce));if(ve(q,$,"encrypt","wrapKey"),qe($,q),q.usages.includes("encrypt"))return new Uint8Array(yield l.subtle.encrypt($e($),q,Q));if(q.usages.includes("wrapKey")){let Z=yield l.subtle.importKey("raw",Q,...Ve);return new Uint8Array(yield l.subtle.wrapKey("raw",Z,q,$e($)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')}))(e,r,L);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{L=n||_e(t);let{p2c:$,p2s:q}=f;B=yield((Xe,Qe,ke,...ai)=>W(this,[Xe,Qe,ke,...ai],function*(Q,Z,re,fe=2048,le=he(new Uint8Array(16))){let En=yield Ut(le,Q,fe,Z);return{encryptedKey:yield at(Q.slice(-6),En,re),p2c:fe,p2s:E(le)}}))(e,r,L,$,q),{encryptedKey:D}=B,K=Je(B,["encryptedKey"]);break}case"A128KW":case"A192KW":case"A256KW":L=n||_e(t),D=yield at(e,r,L);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{L=n||_e(t);let{iv:$}=f;z=yield function(q,Q,Z,re){return W(this,null,function*(){let fe=q.slice(0,7),le=yield er(fe,Z,Q,re,new Uint8Array(0));return{encryptedKey:le.ciphertext,iv:E(le.iv),tag:E(le.tag)}})}(e,r,L,$),{encryptedKey:D}=z,K=Je(z,["encryptedKey"]);break}default:throw new O('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:L,encryptedKey:D,parameters:K}})};class Ye{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=t}setKeyManagementParameters(t){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=t,this}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setSharedUnprotectedHeader(t){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}setAdditionalAuthenticatedData(t){return this._aad=t,this}setContentEncryptionKey(t){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=t,this}setInitializationVector(t){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=t,this}encrypt(t,r){return W(this,null,function*(){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new S("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!Fe(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new S("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let n=J(J(J({},this._protectedHeader),this._unprotectedHeader),this._sharedUnprotectedHeader);if(Ie(S,new Map,r?.crit,this._protectedHeader,n),n.zip!==void 0)throw new O('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:f,enc:c}=n;if(typeof f!="string"||!f)throw new S('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(typeof c!="string"||!c)throw new S('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let h,k,F,D,K;if(this._cek&&(f==="dir"||f==="ECDH-ES"))throw new TypeError('setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header '+f);{let q;({cek:k,encryptedKey:h,parameters:q}=yield ir(f,c,t,this._cek,this._keyManagementParameters)),q&&(r&&rr in r?this._unprotectedHeader?this._unprotectedHeader=J(J({},this._unprotectedHeader),q):this.setUnprotectedHeader(q):this._protectedHeader?this._protectedHeader=J(J({},this._protectedHeader),q):this.setProtectedHeader(q))}D=this._protectedHeader?s.encode(E(JSON.stringify(this._protectedHeader))):s.encode(""),this._aad?(K=E(this._aad),F=m(D,s.encode("."),s.encode(K))):F=D;let{ciphertext:L,tag:B,iv:z}=yield er(c,this._plaintext,k,this._iv,F),$={ciphertext:E(L)};return z&&($.iv=E(z)),B&&($.tag=E(B)),h&&($.encrypted_key=E(h)),K&&($.aad=K),this._protectedHeader&&($.protected=i.decode(D)),this._sharedUnprotectedHeader&&($.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&($.header=this._unprotectedHeader),$})}}class Xr{constructor(t,r,n){this.parent=t,this.key=r,this.options=n}setUnprotectedHeader(t){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}addRecipient(...t){return this.parent.addRecipient(...t)}encrypt(...t){return this.parent.encrypt(...t)}done(){return this.parent}}class Qr{constructor(t){this._recipients=[],this._plaintext=t}addRecipient(t,r){let n=new Xr(this,t,{crit:r?.crit});return this._recipients.push(n),n}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setSharedUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}setAdditionalAuthenticatedData(t){return this._aad=t,this}encrypt(){return W(this,null,function*(){if(!this._recipients.length)throw new S("at least one recipient must be added");if(this._recipients.length===1){let[f]=this._recipients,c=yield new Ye(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(f.unprotectedHeader).encrypt(f.key,J({},f.options)),h={ciphertext:c.ciphertext,iv:c.iv,recipients:[{}],tag:c.tag};return c.aad&&(h.aad=c.aad),c.protected&&(h.protected=c.protected),c.unprotected&&(h.unprotected=c.unprotected),c.encrypted_key&&(h.recipients[0].encrypted_key=c.encrypted_key),c.header&&(h.recipients[0].header=c.header),h}let t;for(let f=0;f<this._recipients.length;f++){let c=this._recipients[f];if(!Fe(this._protectedHeader,this._unprotectedHeader,c.unprotectedHeader))throw new S("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let h=J(J(J({},this._protectedHeader),this._unprotectedHeader),c.unprotectedHeader),{alg:k}=h;if(typeof k!="string"||!k)throw new S('JWE "alg" (Algorithm) Header Parameter missing or invalid');if(k==="dir"||k==="ECDH-ES")throw new S('"dir" and "ECDH-ES" alg may only be used with a single recipient');if(typeof h.enc!="string"||!h.enc)throw new S('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(t){if(t!==h.enc)throw new S('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else t=h.enc;if(Ie(S,new Map,c.options.crit,this._protectedHeader,h),h.zip!==void 0)throw new O('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}let r=_e(t),n={ciphertext:"",iv:"",recipients:[],tag:""};for(let f=0;f<this._recipients.length;f++){let c=this._recipients[f],h={};n.recipients.push(h);let k=J(J(J({},this._protectedHeader),this._unprotectedHeader),c.unprotectedHeader).alg.startsWith("PBES2")?2048+f:void 0;if(f===0){let K=yield new Ye(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(r).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(c.unprotectedHeader).setKeyManagementParameters({p2c:k}).encrypt(c.key,Y(J({},c.options),{[rr]:!0}));n.ciphertext=K.ciphertext,n.iv=K.iv,n.tag=K.tag,K.aad&&(n.aad=K.aad),K.protected&&(n.protected=K.protected),K.unprotected&&(n.unprotected=K.unprotected),h.encrypted_key=K.encrypted_key,K.header&&(h.header=K.header);continue}let{encryptedKey:F,parameters:D}=yield ir(c.unprotectedHeader?.alg||this._protectedHeader?.alg||this._unprotectedHeader?.alg,t,c.key,r,{p2c:k});h.encrypted_key=E(F),(c.unprotectedHeader||D)&&(h.header=J(J({},c.unprotectedHeader),D))}return n})}}function or(e,t){let r="SHA-"+e.slice(-3);switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new O("alg "+e+" is not supported either by JOSE or your javascript runtime")}}function ar(e,t,r){return W(this,null,function*(){if(r==="sign"&&(t=yield Nt(t,e)),r==="verify"&&(t=yield Lt(t,e)),a(t))return function(n,f,...c){switch(f){case"HS256":case"HS384":case"HS512":{if(!be(n.algorithm,"HMAC"))throw oe("HMAC");let h=parseInt(f.slice(2),10);if(Be(n.algorithm.hash)!==h)throw oe("SHA-"+h,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!be(n.algorithm,"RSASSA-PKCS1-v1_5"))throw oe("RSASSA-PKCS1-v1_5");let h=parseInt(f.slice(2),10);if(Be(n.algorithm.hash)!==h)throw oe("SHA-"+h,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!be(n.algorithm,"RSA-PSS"))throw oe("RSA-PSS");let h=parseInt(f.slice(2),10);if(Be(n.algorithm.hash)!==h)throw oe("SHA-"+h,"algorithm.hash");break}case"EdDSA":if(n.algorithm.name!=="Ed25519"&&n.algorithm.name!=="Ed448")throw oe("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!be(n.algorithm,"ECDSA"))throw oe("ECDSA");let h=function(k){switch(k){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(f);if(n.algorithm.namedCurve!==h)throw oe(h,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Tt(n,c)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(se(t,...ce));return l.subtle.importKey("raw",t,{hash:"SHA-"+e.slice(-3),name:"HMAC"},!1,[r])}throw new TypeError(se(t,...ce,"Uint8Array","JSON Web Key"))})}var Zr=(e,t,r,n)=>W(this,null,function*(){let f=yield ar(e,t,"verify");qe(e,f);let c=or(e,f.algorithm);try{return yield l.subtle.verify(c,f,r,n)}catch{return!1}});function pt(e,t,r){return W(this,null,function*(){if(!te(e))throw new j("Flattened JWS must be an object");if(e.protected===void 0&&e.header===void 0)throw new j('Flattened JWS must have either of the "protected" or "header" members');if(e.protected!==void 0&&typeof e.protected!="string")throw new j("JWS Protected Header incorrect type");if(e.payload===void 0)throw new j("JWS Payload missing");if(typeof e.signature!="string")throw new j("JWS Signature missing or incorrect type");if(e.header!==void 0&&!te(e.header))throw new j("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{let z=g(e.protected);n=JSON.parse(i.decode(z))}catch{throw new j("JWS Protected Header is invalid")}if(!Fe(n,e.header))throw new j("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let f=J(J({},n),e.header),c=!0;if(Ie(j,new Map([["b64",!0]]),r?.crit,n,f).has("b64")&&(c=n.b64,typeof c!="boolean"))throw new j('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:h}=f;if(typeof h!="string"||!h)throw new j('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=r&&ut("algorithms",r.algorithms);if(k&&!k.has(h))throw new I('"alg" (Algorithm) Header Parameter value not allowed');if(c){if(typeof e.payload!="string")throw new j("JWS Payload must be a string")}else if(typeof e.payload!="string"&&!(e.payload instanceof Uint8Array))throw new j("JWS Payload must be a string or an Uint8Array instance");let F=!1;typeof t=="function"?(t=yield t(n,e),F=!0,lt(h,t,"verify"),Te(t)&&(t=yield je(t,h))):lt(h,t,"verify");let D=m(s.encode(e.protected??""),s.encode("."),typeof e.payload=="string"?s.encode(e.payload):e.payload),K,L;try{K=g(e.signature)}catch{throw new j("Failed to base64url decode the signature")}if(!(yield Zr(h,t,K,D)))throw new me;if(c)try{L=g(e.payload)}catch{throw new j("Failed to base64url decode the payload")}else L=typeof e.payload=="string"?s.encode(e.payload):e.payload;let B={payload:L};return e.protected!==void 0&&(B.protectedHeader=n),e.header!==void 0&&(B.unprotectedHeader=e.header),F?Y(J({},B),{key:t}):B})}function sr(e,t,r){return W(this,null,function*(){if(e instanceof Uint8Array&&(e=i.decode(e)),typeof e!="string")throw new j("Compact JWS must be a string or Uint8Array");let{0:n,1:f,2:c,length:h}=e.split(".");if(h!==3)throw new j("Invalid Compact JWS");let k=yield pt({payload:f,protected:n,signature:c},t,r),F={payload:k.payload,protectedHeader:k.protectedHeader};return typeof t=="function"?Y(J({},F),{key:k.key}):F})}function en(e,t,r){return W(this,null,function*(){if(!te(e))throw new j("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(te))throw new j("JWS Signatures missing or incorrect type");for(let n of e.signatures)try{return yield pt({header:n.header,payload:e.payload,protected:n.protected,signature:n.signature},t,r)}catch{}throw new me})}var Ee=e=>Math.floor(e.getTime()/1e3);let tn=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;var We=e=>{let t=tn.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");let r=parseFloat(t[2]),n;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(3600*r);break;case"day":case"days":case"d":n=Math.round(86400*r);break;case"week":case"weeks":case"w":n=Math.round(604800*r);break;default:n=Math.round(31557600*r)}return t[1]==="-"||t[4]==="ago"?-n:n};let cr=e=>e.toLowerCase().replace(/^application\//,"");var ht=(e,t,r={})=>{let n;try{n=JSON.parse(i.decode(t))}catch{}if(!te(n))throw new M("JWT Claims Set must be a top-level JSON object");let{typ:f}=r;if(f&&(typeof e.typ!="string"||cr(e.typ)!==cr(f)))throw new _('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:c=[],issuer:h,subject:k,audience:F,maxTokenAge:D}=r,K=[...c];D!==void 0&&K.push("iat"),F!==void 0&&K.push("aud"),k!==void 0&&K.push("sub"),h!==void 0&&K.push("iss");for(let Q of new Set(K.reverse()))if(!(Q in n))throw new _('missing required "'+Q+'" claim',n,Q,"missing");if(h&&!(Array.isArray(h)?h:[h]).includes(n.iss))throw new _('unexpected "iss" claim value',n,"iss","check_failed");if(k&&n.sub!==k)throw new _('unexpected "sub" claim value',n,"sub","check_failed");if(F&&(B=typeof F=="string"?[F]:F,!(typeof(L=n.aud)=="string"?B.includes(L):Array.isArray(L)&&B.some(Set.prototype.has.bind(new Set(L))))))throw new _('unexpected "aud" claim value',n,"aud","check_failed");var L,B;let z;switch(typeof r.clockTolerance){case"string":z=We(r.clockTolerance);break;case"number":z=r.clockTolerance;break;case"undefined":z=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:$}=r,q=Ee($||new Date);if((n.iat!==void 0||D)&&typeof n.iat!="number")throw new _('"iat" claim must be a number',n,"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new _('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>q+z)throw new _('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new _('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=q-z)throw new H('"exp" claim timestamp check failed',n,"exp","check_failed")}if(D){let Q=q-n.iat;if(Q-z>(typeof D=="number"?D:We(D)))throw new H('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(Q<0-z)throw new _('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};function rn(e,t,r){return W(this,null,function*(){let n=yield sr(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&n.protectedHeader.b64===!1)throw new M("JWTs MUST NOT use unencoded payload");let f={payload:ht(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return typeof t=="function"?Y(J({},f),{key:n.key}):f})}function nn(e,t,r){return W(this,null,function*(){let n=yield tr(e,t,r),f=ht(n.protectedHeader,n.plaintext,r),{protectedHeader:c}=n;if(c.iss!==void 0&&c.iss!==f.iss)throw new _('replicated "iss" claim header parameter mismatch',f,"iss","mismatch");if(c.sub!==void 0&&c.sub!==f.sub)throw new _('replicated "sub" claim header parameter mismatch',f,"sub","mismatch");if(c.aud!==void 0&&JSON.stringify(c.aud)!==JSON.stringify(f.aud))throw new _('replicated "aud" claim header parameter mismatch',f,"aud","mismatch");let h={payload:f,protectedHeader:c};return typeof t=="function"?Y(J({},h),{key:n.key}):h})}class xr{constructor(t){this._flattened=new Ye(t)}setContentEncryptionKey(t){return this._flattened.setContentEncryptionKey(t),this}setInitializationVector(t){return this._flattened.setInitializationVector(t),this}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}setKeyManagementParameters(t){return this._flattened.setKeyManagementParameters(t),this}encrypt(t,r){return W(this,null,function*(){let n=yield this._flattened.encrypt(t,r);return[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join(".")})}}class ft{constructor(t){if(!(t instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=t}setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setUnprotectedHeader(t){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=t,this}sign(t,r){return W(this,null,function*(){if(!this._protectedHeader&&!this._unprotectedHeader)throw new j("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Fe(this._protectedHeader,this._unprotectedHeader))throw new j("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n=J(J({},this._protectedHeader),this._unprotectedHeader),f=!0;if(Ie(j,new Map([["b64",!0]]),r?.crit,this._protectedHeader,n).has("b64")&&(f=this._protectedHeader.b64,typeof f!="boolean"))throw new j('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:c}=n;if(typeof c!="string"||!c)throw new j('JWS "alg" (Algorithm) Header Parameter missing or invalid');lt(c,t,"sign");let h,k=this._payload;f&&(k=s.encode(E(k))),h=this._protectedHeader?s.encode(E(JSON.stringify(this._protectedHeader))):s.encode("");let F=m(h,s.encode("."),k),D=yield((L,B,z)=>W(this,null,function*(){let $=yield ar(L,B,"sign");qe(L,$);let q=yield l.subtle.sign(or(L,$.algorithm),$,z);return new Uint8Array(q)}))(c,t,F),K={signature:E(D),payload:""};return f&&(K.payload=i.decode(k)),this._unprotectedHeader&&(K.header=this._unprotectedHeader),this._protectedHeader&&(K.protected=i.decode(h)),K})}}class lr{constructor(t){this._flattened=new ft(t)}setProtectedHeader(t){return this._flattened.setProtectedHeader(t),this}sign(t,r){return W(this,null,function*(){let n=yield this._flattened.sign(t,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return n.protected+"."+n.payload+"."+n.signature})}}class on{constructor(t,r,n){this.parent=t,this.key=r,this.options=n}setProtectedHeader(t){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=t,this}setUnprotectedHeader(t){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=t,this}addSignature(...t){return this.parent.addSignature(...t)}sign(...t){return this.parent.sign(...t)}done(){return this.parent}}class an{constructor(t){this._signatures=[],this._payload=t}addSignature(t,r){let n=new on(this,t,r);return this._signatures.push(n),n}sign(){return W(this,null,function*(){if(!this._signatures.length)throw new j("at least one signature must be added");let t={signatures:[],payload:""};for(let n=0;n<this._signatures.length;n++){let f=this._signatures[n],c=new ft(this._payload);c.setProtectedHeader(f.protectedHeader),c.setUnprotectedHeader(f.unprotectedHeader);let r=yield c.sign(f.key,f.options),{payload:h}=r,k=Je(r,["payload"]);if(n===0)t.payload=h;else if(t.payload!==h)throw new j("inconsistent use of JWS Unencoded Payload (RFC7797)");t.signatures.push(k)}return t})}}function Pe(e,t){if(!Number.isFinite(t))throw new TypeError("Invalid "+e+" input");return t}class gt{constructor(t={}){if(!te(t))throw new TypeError("JWT Claims Set MUST be an object");this._payload=t}setIssuer(t){return this._payload=Y(J({},this._payload),{iss:t}),this}setSubject(t){return this._payload=Y(J({},this._payload),{sub:t}),this}setAudience(t){return this._payload=Y(J({},this._payload),{aud:t}),this}setJti(t){return this._payload=Y(J({},this._payload),{jti:t}),this}setNotBefore(t){return typeof t=="number"?this._payload=Y(J({},this._payload),{nbf:Pe("setNotBefore",t)}):t instanceof Date?this._payload=Y(J({},this._payload),{nbf:Pe("setNotBefore",Ee(t))}):this._payload=Y(J({},this._payload),{nbf:Ee(new Date)+We(t)}),this}setExpirationTime(t){return typeof t=="number"?this._payload=Y(J({},this._payload),{exp:Pe("setExpirationTime",t)}):t instanceof Date?this._payload=Y(J({},this._payload),{exp:Pe("setExpirationTime",Ee(t))}):this._payload=Y(J({},this._payload),{exp:Ee(new Date)+We(t)}),this}setIssuedAt(t){return t===void 0?this._payload=Y(J({},this._payload),{iat:Ee(new Date)}):t instanceof Date?this._payload=Y(J({},this._payload),{iat:Pe("setIssuedAt",Ee(t))}):this._payload=typeof t=="string"?Y(J({},this._payload),{iat:Pe("setIssuedAt",Ee(new Date)+We(t))}):Y(J({},this._payload),{iat:Pe("setIssuedAt",t)}),this}}class sn extends gt{setProtectedHeader(t){return this._protectedHeader=t,this}sign(t,r){return W(this,null,function*(){let n=new lr(s.encode(JSON.stringify(this._payload)));if(n.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new M("JWTs MUST NOT use unencoded payload");return n.sign(t,r)})}}class cn extends gt{setProtectedHeader(t){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=t,this}setKeyManagementParameters(t){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=t,this}setContentEncryptionKey(t){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=t,this}setInitializationVector(t){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=t,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}encrypt(t,r){return W(this,null,function*(){let n=new xr(s.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader=Y(J({},this._protectedHeader),{iss:this._payload.iss})),this._replicateSubjectAsHeader&&(this._protectedHeader=Y(J({},this._protectedHeader),{sub:this._payload.sub})),this._replicateAudienceAsHeader&&(this._protectedHeader=Y(J({},this._protectedHeader),{aud:this._payload.aud})),n.setProtectedHeader(this._protectedHeader),this._iv&&n.setInitializationVector(this._iv),this._cek&&n.setContentEncryptionKey(this._cek),this._keyManagementParameters&&n.setKeyManagementParameters(this._keyManagementParameters),n.encrypt(t,r)})}}let Ce=(e,t)=>{if(typeof e!="string"||!e)throw new V(t+" missing or invalid")};function ur(e,t){return W(this,null,function*(){if(!te(e))throw new TypeError("JWK must be an object");if(t??(t="sha256"),t!=="sha256"&&t!=="sha384"&&t!=="sha512")throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(e.kty){case"EC":Ce(e.crv,'"crv" (Curve) Parameter'),Ce(e.x,'"x" (X Coordinate) Parameter'),Ce(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":Ce(e.crv,'"crv" (Subtype of Key Pair) Parameter'),Ce(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":Ce(e.e,'"e" (Exponent) Parameter'),Ce(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":Ce(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new O('"kty" (Key Type) Parameter missing or unsupported')}let n=s.encode(JSON.stringify(r));return E(yield v(t,n))})}function xn(e,t){return W(this,null,function*(){t??(t="sha256");let r=yield ur(e,t);return"urn:ietf:params:oauth:jwk-thumbprint:sha-"+t.slice(-3)+":"+r})}function ln(e,t){return W(this,null,function*(){let r=J(J({},e),t?.header);if(!te(r.jwk))throw new j('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let n=yield je(Y(J({},r.jwk),{ext:!0}),r.alg);if(n instanceof Uint8Array||n.type!=="public")throw new j('"jwk" (JSON Web Key) Header Parameter must be a public key');return n})}function un(e){return te(e)}function dr(e){return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}class dn{constructor(t){if(this._cached=new WeakMap,!function(r){return r&&typeof r=="object"&&Array.isArray(r.keys)&&r.keys.every(un)}(t))throw new N("JSON Web Key Set malformed");this._jwks=dr(t)}getKey(t,r){return W(this,null,function*(){let{alg:n,kid:f}=J(J({},t),r?.header),c=function(D){switch(typeof D=="string"&&D.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new O('Unsupported "alg" value for a JSON Web Key Set')}}(n),h=this._jwks.keys.filter(D=>{let K=c===D.kty;if(K&&typeof f=="string"&&(K=f===D.kid),K&&typeof D.alg=="string"&&(K=n===D.alg),K&&typeof D.use=="string"&&(K=D.use==="sig"),K&&Array.isArray(D.key_ops)&&(K=D.key_ops.includes("verify")),K&&n==="EdDSA"&&(K=D.crv==="Ed25519"||D.crv==="Ed448"),K)switch(n){case"ES256":K=D.crv==="P-256";break;case"ES256K":K=D.crv==="secp256k1";break;case"ES384":K=D.crv==="P-384";break;case"ES512":K=D.crv==="P-521"}return K}),{0:k,length:F}=h;if(F===0)throw new ie;if(F!==1){let D=new ne,{_cached:K}=this;throw D[Symbol.asyncIterator]=function(){return fr(this,null,function*(){for(let L of h)try{yield yield new hr(pr(K,L,n))}catch{}})},D}return pr(this._cached,k,n)})}}function pr(e,t,r){return W(this,null,function*(){let n=e.get(t)||e.set(t,{}).get(t);if(n[r]===void 0){let f=yield je(Y(J({},t),{ext:!0}),r);if(f instanceof Uint8Array||f.type!=="public")throw new N("JSON Web Key Set members must be public keys");n[r]=f}return n[r]})}function mt(e){let t=new dn(e),r=(n,f)=>W(this,null,function*(){return t.getKey(n,f)});return Object.defineProperties(r,{jwks:{value:()=>dr(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}let yt;typeof navigator<"u"&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(yt="jose/v5.9.6");let Ue=Symbol();class pn{constructor(t,r){if(!(t instanceof URL))throw new TypeError("url must be an instance of URL");var n,f;this._url=new URL(t.href),this._options={agent:r?.agent,headers:r?.headers},this._timeoutDuration=typeof r?.timeoutDuration=="number"?r?.timeoutDuration:5e3,this._cooldownDuration=typeof r?.cooldownDuration=="number"?r?.cooldownDuration:3e4,this._cacheMaxAge=typeof r?.cacheMaxAge=="number"?r?.cacheMaxAge:6e5,r?.[Ue]!==void 0&&(this._cache=r?.[Ue],n=r?.[Ue],f=this._cacheMaxAge,typeof n=="object"&&n!==null&&"uat"in n&&typeof n.uat=="number"&&!(Date.now()-n.uat>=f)&&"jwks"in n&&te(n.jwks)&&Array.isArray(n.jwks.keys)&&Array.prototype.every.call(n.jwks.keys,te)&&(this._jwksTimestamp=this._cache.uat,this._local=mt(this._cache.jwks)))}coolingDown(){return typeof this._jwksTimestamp=="number"&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return typeof this._jwksTimestamp=="number"&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}getKey(t,r){return W(this,null,function*(){this._local&&this.fresh()||(yield this.reload());try{return yield this._local(t,r)}catch(n){if(n instanceof ie&&this.coolingDown()===!1)return yield this.reload(),this._local(t,r);throw n}})}reload(){return W(this,null,function*(){this._pendingFetch&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel")&&(this._pendingFetch=void 0);let t=new Headers(this._options.headers);yt&&!t.has("User-Agent")&&(t.set("User-Agent",yt),this._options.headers=Object.fromEntries(t.entries())),this._pendingFetch||(this._pendingFetch=((r,n,f)=>W(this,null,function*(){let c,h,k=!1;typeof AbortController=="function"&&(c=new AbortController,h=setTimeout(()=>{k=!0,c.abort()},n));let F=yield fetch(r.href,{signal:c?c.signal:void 0,redirect:"manual",headers:f.headers}).catch(D=>{throw k?new de:D});if(h!==void 0&&clearTimeout(h),F.status!==200)throw new b("Expected 200 OK from the JSON Web Key Set HTTP response");try{return yield F.json()}catch{throw new b("Failed to parse the JSON Web Key Set HTTP response as JSON")}}))(this._url,this._timeoutDuration,this._options).then(r=>{this._local=mt(r),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=r),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(r=>{throw this._pendingFetch=void 0,r})),yield this._pendingFetch})}}function hn(e,t){let r=new pn(e,t),n=(f,c)=>W(this,null,function*(){return r.getKey(f,c)});return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}let fn=Ue;class gn extends gt{encode(){return E(JSON.stringify({alg:"none"}))+"."+E(JSON.stringify(this._payload))+"."}static decode(t,r){if(typeof t!="string")throw new M("Unsecured JWT must be a string");let{0:n,1:f,2:c,length:h}=t.split(".");if(h!==3||c!=="")throw new M("Invalid Unsecured JWT");let k;try{if(k=JSON.parse(i.decode(g(n))),k.alg!=="none")throw new Error}catch{throw new M("Invalid Unsecured JWT")}return{payload:ht(k,g(f),r),header:k}}}let mn=E,wt=g;function yn(e){let t;if(typeof e=="string"){let r=e.split(".");r.length!==3&&r.length!==5||([t]=r)}else if(typeof e=="object"&&e){if(!("protected"in e))throw new TypeError("Token does not contain a Protected Header");t=e.protected}try{if(typeof t!="string"||!t)throw new Error;let r=JSON.parse(i.decode(wt(t)));if(!te(r))throw new Error;return r}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function wn(e){if(typeof e!="string")throw new M("JWTs must use Compact JWS serialization, JWT must be a string");let{1:t,length:r}=e.split(".");if(r===5)throw new M("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new M("Invalid JWT");if(!t)throw new M("JWTs must contain a payload");let n,f;try{n=wt(t)}catch{throw new M("Failed to base64url decode the payload")}try{f=JSON.parse(i.decode(n))}catch{throw new M("Failed to parse the decoded payload as JSON")}if(!te(f))throw new M("Invalid JWT Claims Set");return f}function bt(e){let t=e?.modulusLength??2048;if(typeof t!="number"||t<2048)throw new O("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}function bn(e,t){return W(this,null,function*(){return function(r,n){return W(this,null,function*(){let f,c;switch(r){case"PS256":case"PS384":case"PS512":f={name:"RSA-PSS",hash:"SHA-"+r.slice(-3),publicExponent:new Uint8Array([1,0,1]),modulusLength:bt(n)},c=["sign","verify"];break;case"RS256":case"RS384":case"RS512":f={name:"RSASSA-PKCS1-v1_5",hash:"SHA-"+r.slice(-3),publicExponent:new Uint8Array([1,0,1]),modulusLength:bt(n)},c=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":f={name:"RSA-OAEP",hash:"SHA-"+(parseInt(r.slice(-3),10)||1),publicExponent:new Uint8Array([1,0,1]),modulusLength:bt(n)},c=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":f={name:"ECDSA",namedCurve:"P-256"},c=["sign","verify"];break;case"ES384":f={name:"ECDSA",namedCurve:"P-384"},c=["sign","verify"];break;case"ES512":f={name:"ECDSA",namedCurve:"P-521"},c=["sign","verify"];break;case"EdDSA":{c=["sign","verify"];let h=n?.crv??"Ed25519";switch(h){case"Ed25519":case"Ed448":f={name:h};break;default:throw new O("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{c=["deriveKey","deriveBits"];let h=n?.crv??"P-256";switch(h){case"P-256":case"P-384":case"P-521":f={name:"ECDH",namedCurve:h};break;case"X25519":case"X448":f={name:h};break;default:throw new O("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return l.subtle.generateKey(f,n?.extractable??!1,c)})}(e,t)})}function vn(e,t){return W(this,null,function*(){return function(r,n){return W(this,null,function*(){let f,c,h;switch(r){case"HS256":case"HS384":case"HS512":f=parseInt(r.slice(-3),10),c={name:"HMAC",hash:"SHA-"+f,length:f},h=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return f=parseInt(r.slice(-3),10),he(new Uint8Array(f>>3));case"A128KW":case"A192KW":case"A256KW":f=parseInt(r.slice(1,4),10),c={name:"AES-KW",length:f},h=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":f=parseInt(r.slice(1,4),10),c={name:"AES-GCM",length:f},h=["encrypt","decrypt"];break;default:throw new O('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return l.subtle.generateKey(c,n?.extractable??!1,h)})}(e,t)})}var An="WebCryptoAPI"}},X={};function G(U){var o=X[U];if(o!==void 0)return o.exports;var u=X[U]={exports:{}};return ee[U].call(u.exports,u,u.exports,G),u.exports}G.d=function(U,o){for(var u in o)G.o(o,u)&&!G.o(U,u)&&Object.defineProperty(U,u,{enumerable:!0,get:o[u]})},G.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),G.o=function(U,o){return Object.prototype.hasOwnProperty.call(U,o)},G.r=function(U){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(U,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(U,"__esModule",{value:!0})};var ae={};return function(){"use strict";var U=ae;let o=G(328),u=G(736),P=G(8),x=G(632);x.default;let l=G(288);l.default;let a=G(276),v=G(0);o.Utils.reporting=a,o.Formio.Report=x.default,U.default={Report:x.default,ReportingUtils:l.default,components:u.default,templates:P.default,utils:a,library:v.default}}(),ae.default}()})});var Kr=vt(kt());var Se=class ee{constructor(X,G){this.app=X;this.alerts=G}report;loadReports(){return W(this,null,function*(){yield this.app.ready;let X=[];try{X=new St.FormioCore(`${this.app.projectUrl}/reportingui/submission`).loadSubmissions()}catch(G){this.alerts.add({level:_t.AlertLevel.ERROR,message:G.message||G})}return X})}loadReport(X){return W(this,null,function*(){if(!X)return null;try{let G=new St.FormioCore(`${this.app.projectUrl}/reportingui/submission/${X}`);this.report=yield G.loadSubmission()}catch(G){throw this.alerts.add({level:_t.AlertLevel.ERROR,message:G.message||G}),G}return this.report})}createReport(U,o){return W(this,arguments,function*(X,G,ae={}){return Kr.Report.create(X,`${this.app.projectUrl}/reportingui/submission/${G}`,ae)})}static \u0275fac=function(G){return new(G||ee)(At(Hr),At(Rr))};static \u0275prov=gr({token:ee,factory:ee.\u0275fac,providedIn:"root"})};function On(ee,X){if(ee&1&&(xe(0,"a",8)(1,"div",9)(2,"div",10)(3,"div",11),pe(4),ue(),xe(5,"div",12),pe(6),De(7,"date"),ue(),xe(8,"div",12),pe(9),De(10,"date"),ue()()(),xe(11,"div",13)(12,"a",14),Oe(13,"i",15),ue()()()),ee&2){let G=X.$implicit;ge(),Ct("routerLink",G._id),ge(3),et(G.data.title),ge(2),Ge("created ",Le(7,5,G.created,"short"),""),ge(3),Ge("modified ",Le(10,8,G.modified,"short"),""),ge(3),Ct("routerLink",G._id)}}var it=class ee{constructor(X){this.service=X}reports;ngOnInit(){this.reports=this.service.loadReports()}static \u0275fac=function(G){return new(G||ee)(Me(Se))};static \u0275cmp=Ze({type:ee,selectors:[["form-reports"]],decls:13,vars:3,consts:[[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"my-2","d-flex","gap-2","align-items-center",2,"font-size","16px"],[1,"bi","fs-4","bi-clipboard-data"],[1,"form-list-header","list-group-flush","d-flex","flex-row","justify-content-between","align-items-center","mb-2"],[1,"col-10","ps-3","fw-3","text-muted"],[1,"col-2","ps-3","fw-3","text-muted"],[1,"list-group","list-group-flush","list-group-light"],["class","list-group-item list-group-item-action d-flex flex-row  align-items-center py-4  mb-2 shadow-sm rounded",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","d-flex","flex-row","align-items-center","py-4","mb-2","shadow-sm","rounded"],[1,"col-10","ms-3","mr-auto","d-flex","flex-row","gap-4","justify-content-start","align-items-center","cursor-pointer",3,"routerLink"],[1,"ms-3","me-auto"],[1,"fs-4","fw-3","text-muted"],[1,"fs-6","fw-lighter","text-muted"],[1,"col-2","form-actions","d-flex","flex-row","align-items-start","gap-2","justify-content-center","ml-auto"],[1,"btn","btn-primary","btn-icon","btn-xs","rounded-circle",3,"routerLink"],[1,"bi","bi-eye","fs-xs"]],template:function(G,ae){G&1&&(xe(0,"div",0)(1,"h5",1),Oe(2,"i",2),pe(3," Your Reports "),ue()(),xe(4,"div",3)(5,"div",4),pe(6,"Title"),ue(),xe(7,"div",5),pe(8,"Actions"),ue()(),Oe(9,"hr"),xe(10,"ul",6),wr(11,On,14,11,"a",7),De(12,"async"),ue()),G&2&&(ge(11),br("ngForOf",Cr(12,1,ae.reports)))},dependencies:[Sr,rt,_r,tt],encapsulation:2})};var Fr=(ee,X,G=Et(Se),ae=Et(Or))=>G.loadReport(ee.paramMap.get("reportId")).catch(()=>ae.navigate([".."]));var Tn=["report"],ot=class ee{constructor(X,G){this.service=X;this.route=G}report;ngAfterViewInit(){this.service.createReport(this.report.nativeElement,this.route.snapshot.params.reportId)}static \u0275fac=function(G){return new(G||ee)(Me(Se),Me(kr))};static \u0275cmp=Ze({type:ee,selectors:[["form-report"]],viewQuery:function(G,ae){if(G&1&&vr(Tn,7),G&2){let U;Ar(U=Er())&&(ae.report=U.first)}},decls:14,vars:5,consts:[["report",""],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"my-2","d-flex","gap-2","align-items-center",2,"font-size","16px"],[1,"bi","me-2","fs-5","bi-clipboard-data"],["routerLink","..",1,"nav-link","cursor-pointer"],[1,"text-primary"],[1,"text-body-tertiary",2,"font-size","14px"],[1,"divider","mb-4"],[1,"py-3"]],template:function(G,ae){G&1&&(xe(0,"div",1)(1,"h5",2),Oe(2,"i",3),xe(3,"a",4),pe(4,"Reports"),ue(),pe(5," / "),xe(6,"span",5),pe(7),ue()(),xe(8,"span",6),pe(9),De(10,"date"),ue()(),Oe(11,"div",7)(12,"div",8,0)),G&2&&(ge(7),et(ae.service.report==null||ae.service.report.data==null?null:ae.service.report.data.title),ge(2),Ge("Created: ",Le(10,2,ae.service.report==null?null:ae.service.report.created,"short"),""))},dependencies:[rt,tt],encapsulation:2})};var Ir=vt(Sn()),Wr=vt(kt());Ir.Formio.use(Wr.default);var jr=class ee{static \u0275fac=function(G){return new(G||ee)};static \u0275mod=yr({type:ee});static \u0275inj=mr({imports:[Pr,Tr.forChild([{path:"",component:it},{path:":reportId",resolve:{report:Fr},component:ot}])]})};export{jr as ReportModule};
